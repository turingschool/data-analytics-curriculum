I"Õ"<h3 id="goals">Goals</h3>

<p>By the end of this lesson, you will know/be able to:</p>

<ul>
  <li>define partial and helper method</li>
  <li>extract repetitive view code into a partial</li>
  <li>create helper methods to dynamically generate HTML</li>
</ul>

<h3 id="structure">Structure</h3>

<h3 id="video">Video</h3>

<ul>
  <li>None Yet</li>
</ul>

<h3 id="repository">Repository</h3>

<ul>
  <li><a href="https://github.com/turingschool-examples/partial-arts">PartialArts</a></li>
</ul>

<h3 id="lecture">Lecture</h3>

<h4 id="warmup">Warmup:</h4>

<ul>
  <li>How do we normally deal with repeated code?</li>
  <li>Where do you see repeated code in the views?</li>
  <li>Ideas for how to solve this?</li>
</ul>

<h4 id="together">Together:</h4>

<h5 id="extract-the-artist-div-into-a-partial">Extract the Artist Div into a Partial</h5>

<p>The way that you extract repetitive code in ERB views is to use a <em>partial</em>. In your views folder <code class="highlighter-rouge">touch</code> a new file called <code class="highlighter-rouge">_artist.erb</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ touch app/views/_artist.erb
</code></pre></div></div>

<p>Find one instance of the <code class="highlighter-rouge">&lt;div class="artist"&gt;...&lt;/div&gt;</code> (e.g. in <code class="highlighter-rouge">/app/views/artists/index.erb</code>), copy the <code class="highlighter-rouge">div</code> with the class of <code class="highlighter-rouge">artist</code> and paste it into your newly created partial file. So, in <code class="highlighter-rouge">/app/views/_artist.erb</code> you should now have the following:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"artist"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"</span><span class="cp">&lt;%=</span> <span class="n">artist</span><span class="p">.</span><span class="nf">image_url</span> <span class="cp">%&gt;</span><span class="s">"</span> <span class="na">alt=</span><span class="s">""</span><span class="nt">&gt;</span> <span class="nt">&lt;br&gt;</span>
  <span class="nt">&lt;h3&gt;&lt;a</span> <span class="na">href=</span><span class="s">"/artists/</span><span class="cp">&lt;%=</span> <span class="n">artist</span><span class="p">.</span><span class="nf">id</span> <span class="cp">%&gt;</span><span class="s">"</span><span class="nt">&gt;</span><span class="cp">&lt;%=</span> <span class="n">artist</span><span class="p">.</span><span class="nf">first_name</span> <span class="cp">%&gt;</span> <span class="cp">&lt;%=</span> <span class="n">artist</span><span class="p">.</span><span class="nf">last_name</span> <span class="cp">%&gt;</span><span class="nt">&lt;/a&gt;&lt;/h3&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<p>Now we have access to the <code class="highlighter-rouge">artist</code> partial, but weâ€™re not making use of it. Letâ€™s go back to the <code class="highlighter-rouge">/app/views/artists/index.erb</code> file and replace the code we have with a call to this partial.</p>

<p>In that file, replace the artist div with the following:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;</span><span class="err">=%</span> <span class="na">erb</span> <span class="na">:_artist</span><span class="err">,</span> <span class="na">locals:</span> <span class="err">{</span><span class="na">artist:</span> <span class="na">artist</span><span class="err">}%</span><span class="nt">&gt;</span>
</code></pre></div></div>

<p>A couple of things to notice:</p>

<ol>
  <li>Youâ€™re calling <code class="highlighter-rouge">erb</code> the same way you would normally in your controller. This is just more ruby code that is going to get evaluated because itâ€™s in your ERB template.</li>
  <li>Youâ€™re also passing a local variable <code class="highlighter-rouge">artist</code> into this partial. If you look back at the partial, youâ€™ll see that you need to have access to an artist. The only way that youâ€™ll get it into your partial is by passing it from here in the <code class="highlighter-rouge">index.erb</code> file where youâ€™re calling it.</li>
</ol>

<p>Check in your browser to see if the <code class="highlighter-rouge">artist</code> div is still rendering properly when you visit <code class="highlighter-rouge">/artists</code>. If so, go back to the other places you saw that repeated code (the <code class="highlighter-rouge">index.erb</code> files for <code class="highlighter-rouge">belts</code> and <code class="highlighter-rouge">categories</code>) and use your partial there as well. Check to make sure that <code class="highlighter-rouge">/belts</code> and <code class="highlighter-rouge">/categories</code> are both still rendering correctly.</p>

<h5 id="implement-a-url-helper-for-artistsid">Implement a URL Helper for â€˜/artists/:idâ€™</h5>

<p>Letâ€™s take another look at our partial. Itâ€™s not the biggest deal, but it seems like that link to the specific artistâ€™s page is a little long. Wouldnâ€™t it be nice if in our view we could have a simpler representation of that code? Letâ€™s create a URL helper to do just that.</p>

<p>Helper methods are going to be methods that weâ€™re able to call from our ERB. While we could do this in any of our controllers (each of them is basically extending the functionality of our <code class="highlighter-rouge">PartialArts</code> class) letâ€™s do this in <code class="highlighter-rouge">/app/controllers/partial_arts_controller.rb</code>. This code is going to be available in each of our views, and that feels like the best place to hold something that applies to all of the views rather than one in particular.</p>

<p>In that controller, letâ€™s create an <code class="highlighter-rouge">artists_url</code> method that we can call in our artist partial. Copy the full HTML code for the link into that method. One thing to notice: in our ERB template weâ€™re using ERB tags to basically do some string interpolation. Now that weâ€™re moving this into our controller letâ€™s do that string interpolation here so that weâ€™re just dropping a string into our ERB file. In order to do that, weâ€™ll have to switch the ERB tags to Ruby style string interpolation (see the #{} in the code below?)</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">helpers</span> <span class="k">do</span>
  <span class="k">def</span> <span class="nf">artist_url</span><span class="p">(</span><span class="n">artist</span><span class="p">)</span>
    <span class="s2">"&lt;a href='/artists/</span><span class="si">#{</span><span class="n">artist</span><span class="p">.</span><span class="nf">id</span><span class="si">}</span><span class="s2">'&gt;</span><span class="si">#{</span><span class="n">artist</span><span class="p">.</span><span class="nf">first_name</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">artist</span><span class="p">.</span><span class="nf">last_name</span><span class="si">}</span><span class="s2">&lt;/a&gt;"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Now, anywhere in our views we should be able to use <code class="highlighter-rouge">artist_url(artist)</code> to create a link to a specific artist.</p>

<p>Go back to your <code class="highlighter-rouge">/app/views/_artist.erb</code> partial and replace the link to the artist with the following:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;%=</span> <span class="n">artist_url</span><span class="p">(</span><span class="n">artist</span><span class="p">)</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<p>Visit <code class="highlighter-rouge">/artists</code> to see if everything is still working. Yes? Good!</p>

<h4 id="in-pairs">In Pairs:</h4>

<p>With the time you have left complete the following tasks with a pair:</p>

<ul>
  <li>Implement a url helper for â€˜/â€™ (root) and use it as a link at the top of artists_index, belts_index, and categories_index</li>
  <li>Extract the Category Statistics div into a partial</li>
  <li>Extract the Belt Statistics div into a partial</li>
  <li>Extract the Location Statistics div into a partial</li>
  <li>Implement a helper to correctly pluralize â€˜artistâ€™ in â€˜welcome.erbâ€™</li>
</ul>

<h3 id="resources">Resources</h3>

<ul>
  <li><a href="http://www.sinatrarb.com/faq.html#partials">Sinatra Partials Documentation</a></li>
  <li><a href="http://www.sinatrarb.com/faq.html#helpview">Sinatra Helpers Documentation</a></li>
</ul>

:ET