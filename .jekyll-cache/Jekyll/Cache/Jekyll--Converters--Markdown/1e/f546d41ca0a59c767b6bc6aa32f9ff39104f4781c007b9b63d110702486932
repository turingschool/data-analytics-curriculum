I"k<h3 id="goals">Goals</h3>

<p>By the end of this lesson, you will know/be able to:</p>

<ul>
  <li>Explain what a multi-tenant application is, and why we need one.</li>
  <li>Implement multi-tenancy at a routes level</li>
  <li>Implement multi-tenancy at the controller level.</li>
  <li>Design a database scheme for a multi-tenant application.</li>
</ul>

<h3 id="structure">Structure</h3>

<ul>
  <li>10 - Conversation: High Level Multi-tenancy</li>
  <li>15 - App Setup</li>
  <li>5  - Break</li>
  <li>25 - Setting up routes and controllers for Multi-tenancy</li>
  <li>5  - Break</li>
  <li>25 - Database level Multi-tenancy</li>
  <li>5  - Break</li>
  <li>20 - Workshop 1</li>
  <li>5  - Questions</li>
</ul>

<h2 id="multi-tenancy-what-is-it-and-why-do-we-need-it">Multi-tenancy. What is it? and why do we need it?</h2>

<ul>
  <li>First there was a store.</li>
  <li>Then there was a marketplace.</li>
  <li>Examples of Multi-tenant applications - ebay, shopify, squarespace, etsy.</li>
  <li>Basically a single instance of the software is deployed vs. many instances.</li>
  <li>Single maintained large dataset that breaks down into smaller datasets for each customer/owner.</li>
</ul>

<h2 id="issuesconcerns-of-a-multi-tanant-site">Issues/Concerns of a Multi-tanant site.</h2>

<ul>
  <li>Authentication.</li>
  <li>Authorization - Scoping by role.
    <ul>
      <li>keeping one store from accessing and changing data from a different store.</li>
    </ul>
  </li>
  <li>Database design and relationships.</li>
</ul>

<h2 id="multi-tenant-routing">Multi-tenant Routing</h2>

<ul>
  <li>A single store software platform. What we’ve seen so far:
    <ul>
      <li><code class="highlighter-rouge">/items</code></li>
      <li>‘/items/:id’ –&gt; <code class="highlighter-rouge">/items/12</code></li>
    </ul>
  </li>
  <li>We need nested data for stores. We need a way to represent data for specific stores / tenants. What will our routes look like?</li>
  <li>What we need for multi-tenancy:
    <ul>
      <li><code class="highlighter-rouge">/:store_name/items</code></li>
      <li><code class="highlighter-rouge">/:store_name/items/:id</code> –&gt; <code class="highlighter-rouge">/:store_name/items/12</code></li>
    </ul>
  </li>
</ul>

<h4 id="how">How?</h4>

<ul>
  <li>Namespacing in the router.</li>
</ul>

<h2 id="multi-tenancy-controllers-whos-is-whos">Multi-tenancy Controllers. Whos is whos?</h2>

<ul>
  <li>Implementing multi-tenancy means we need to scope controllers to account for different user roles.</li>
  <li>ItemsController vs Store::ItemsController</li>
</ul>

<h4 id="how-1">How?</h4>

<ul>
  <li>Namespacing in the router.</li>
</ul>

<h2 id="so-now-what-lets-do-it">So now what? Let’s do it.</h2>

<p>Let’s work through making the storedom repo, currently a single store platform, a multi-tenant platform.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/turingschool-examples/storedom.git multitenancy
cd multitenancy
bundle &amp;&amp; bundle exec rake db:drop db:setup
</code></pre></div></div>

<h3 id="what-do-we-want-to-accomplish">What do we want to accomplish?</h3>

<ol>
  <li>We need to model our store.</li>
  <li>We need to view our stores in the app (at least an index / show)</li>
  <li>We need a way to associate an item with a store.</li>
  <li>We need to establish the correct relationship between stores and their items.</li>
  <li>We need a way to view an item within the app <em>and know which store it actually belongs to</em>.</li>
  <li>We need to prevent access to items in the wrong store.</li>
</ol>

<h3 id="video">Video</h3>

<ul>
  <li><a href="https://vimeo.com/142297870">Understanding Multi-Tenancy - Oct. 2015</a></li>
  <li><a href="https://vimeo.com/128198524">Understanding Multi-Tenancy - May. 2015</a></li>
</ul>

<h3 id="repository">Repository</h3>

<ul>
  <li><a href="https://github.com/turingschool-examples/storedom">Repo for the lesson</a></li>
</ul>

<h3 id="resources">Resources</h3>

<ul>
  <li><a href="https://quickleft.com/blog/what-is-a-multi-tenant-application/">QuickLeft blog post/ discussion on Multi-tenancy</a>
*</li>
</ul>
:ET