I"®S<h2 id="learning-goals">Learning Goals</h2>

<ul>
  <li>Understand how to seed data in Rails in a timely manner</li>
  <li>Know when to update the seed file in the development process</li>
  <li>How to use Faker</li>
  <li>How to set up relationships</li>
</ul>

<h2 id="setup-building-an-inefficient-seed-file">Setup: Building an Inefficient Seed File</h2>

<p>Clone down the following repo:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone -b seeding_data https://github.com/turingschool-examples/storedom.git seeding_data  
bundle - you may need to bundle update  
rake db:create  
rake db:migrate  
</code></pre></div></div>

<p>Typically in a Rails app, youâ€™ll seed the database by using the rake task â€˜rake db:seedâ€™, which runs the ruby file â€˜db/seeds.rbâ€™.</p>

<h3 id="iteration-1-creating-records">Iteration 1: Creating Records</h3>
<p>Create some data:<br />
  4 users w/ name and email<br />
  4 items w/ name, description, and image_url</p>

<h4 id="create-one-user">Create one user</h4>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">User</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"Chad Clancey"</span><span class="p">,</span> <span class="ss">email: </span><span class="s2">"cclancey@example.com"</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="create-four-users">Create four users</h4>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">User</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"Lauren"</span><span class="p">,</span> <span class="ss">email: </span><span class="s2">"lauren@example.com"</span><span class="p">)</span>
<span class="no">User</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"Josh"</span><span class="p">,</span> <span class="ss">email: </span><span class="s2">"josh@example.com"</span><span class="p">)</span>
<span class="no">User</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"Sally"</span><span class="p">,</span> <span class="ss">email: </span><span class="s2">"sally@example.com"</span><span class="p">)</span>
<span class="no">User</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"Chaz"</span><span class="p">,</span> <span class="ss">email: </span><span class="s2">"chaz@example.com"</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="create-an-item">Create an item</h4>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Item</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span>
  <span class="ss">name: </span><span class="s2">"Red Panda"</span><span class="p">,</span>
  <span class="ss">description: </span><span class="s2">"Small arboreal mammal native to the eastern Himalayas and southwestern China "</span><span class="p">,</span>
  <span class="ss">image_url: </span><span class="s2">"http://robohash.org/1.png?set=set2&amp;bgset=bg1&amp;size=200x200"</span>
  <span class="p">)</span>
</code></pre></div></div>

<h4 id="create-four-items">Create four items</h4>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="no">Item</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span>
    <span class="ss">name: </span><span class="s2">"Red Panda 1"</span><span class="p">,</span>
    <span class="ss">description: </span><span class="s2">"Small arboreal mammal native to the eastern Himalayas and southwestern China "</span><span class="p">,</span>
    <span class="ss">image_url: </span><span class="s2">"http://robohash.org/1.png?set=set2&amp;bgset=bg1&amp;size=200x200"</span>
  <span class="p">)</span>

  <span class="no">Item</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span>
    <span class="ss">name: </span><span class="s2">"Red Panda 2"</span><span class="p">,</span>
    <span class="ss">description: </span><span class="s2">"Small arboreal mammal native to the eastern Himalayas and southwestern China "</span><span class="p">,</span>
    <span class="ss">image_url: </span><span class="s2">"http://robohash.org/2.png?set=set2&amp;bgset=bg1&amp;size=200x200"</span>
  <span class="p">)</span>

  <span class="no">Item</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span>
    <span class="ss">name: </span><span class="s2">"Red Panda 3"</span><span class="p">,</span>
    <span class="ss">description: </span><span class="s2">"Small arboreal mammal native to the eastern Himalayas and southwestern China "</span><span class="p">,</span>
    <span class="ss">image_url: </span><span class="s2">"http://robohash.org/3.png?set=set2&amp;bgset=bg1&amp;size=200x200"</span>
  <span class="p">)</span>

  <span class="no">Item</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span>
    <span class="ss">name: </span><span class="s2">"Red Panda 4"</span><span class="p">,</span>
    <span class="ss">description: </span><span class="s2">"Small arboreal mammal native to the eastern Himalayas and southwestern China "</span><span class="p">,</span>
    <span class="ss">image_url: </span><span class="s2">"http://robohash.org/4.png?set=set2&amp;bgset=bg1&amp;size=200x200"</span>
  <span class="p">)</span>
</code></pre></div></div>

<p>What are the downsides to this approach?</p>

<h2 id="why-seeding-data-efficiently-matters">Why Seeding Data Efficiently Matters</h2>

<ul>
  <li>Setting up each record by hand takes quite a bit of time that could be used doing something else</li>
  <li>You might have already seen or will see at some point in the future the 300+ line seed file</li>
  <li>Problems of seeding generally stem from doing too much manual / hard-coded work</li>
  <li>We should treat our seed file as just another piece of code (aka make it Object Oriented)</li>
  <li>Use methods as abstractions for common operations</li>
  <li>Use libraries to generate data we need (often randomized data to simulate real users)</li>
  <li>Use Rails / ActiveRecord idioms to pre-fill relationships in a straightforward way</li>
  <li>Use loops and parameterization to control repeated seeding</li>
</ul>

<h2 id="iteration-2-removing-duplication">Iteration 2: Removing Duplication</h2>

<p>Manually entering all these details is tedious and becomes difficult to maintain over time. We should automate the seed data that doesnâ€™t really matter. We are going to use the <a href="https://github.com/stympy/faker">Faker</a> gem for this.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Gemfile</span>
<span class="n">gem</span> <span class="s1">'faker'</span>
</code></pre></div></div>

<p>There are several different types of data that you can specify with the gem. Weâ€™ll touch on a few here. Check out the docs for a more extensive list of whatâ€™s available. Letâ€™s update our <code class="highlighter-rouge">User</code> creation to automatically fill in the name and email.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">User</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span><span class="ss">name: </span><span class="no">Faker</span><span class="o">::</span><span class="no">Name</span><span class="p">.</span><span class="nf">name</span><span class="p">,</span> <span class="ss">email: </span><span class="no">Faker</span><span class="o">::</span><span class="no">Internet</span><span class="p">.</span><span class="nf">email</span><span class="p">)</span>
<span class="no">User</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span><span class="ss">name: </span><span class="no">Faker</span><span class="o">::</span><span class="no">Name</span><span class="p">.</span><span class="nf">name</span><span class="p">,</span> <span class="ss">email: </span><span class="no">Faker</span><span class="o">::</span><span class="no">Internet</span><span class="p">.</span><span class="nf">email</span><span class="p">)</span>
<span class="no">User</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span><span class="ss">name: </span><span class="no">Faker</span><span class="o">::</span><span class="no">Name</span><span class="p">.</span><span class="nf">name</span><span class="p">,</span> <span class="ss">email: </span><span class="no">Faker</span><span class="o">::</span><span class="no">Internet</span><span class="p">.</span><span class="nf">email</span><span class="p">)</span>
<span class="no">User</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span><span class="ss">name: </span><span class="no">Faker</span><span class="o">::</span><span class="no">Name</span><span class="p">.</span><span class="nf">name</span><span class="p">,</span> <span class="ss">email: </span><span class="no">Faker</span><span class="o">::</span><span class="no">Internet</span><span class="p">.</span><span class="nf">email</span><span class="p">)</span>
</code></pre></div></div>

<p>We can do something similar with item creation as well. Update your code to look something like this.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Item</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span>
  <span class="ss">name: </span><span class="no">Faker</span><span class="o">::</span><span class="no">Commerce</span><span class="p">.</span><span class="nf">product_name</span><span class="p">,</span>
  <span class="ss">description: </span><span class="no">Faker</span><span class="o">::</span><span class="no">Lorem</span><span class="p">.</span><span class="nf">paragraph</span><span class="p">,</span>
  <span class="ss">image_url: </span><span class="s2">"http://robohash.org/1.png?set=set2&amp;bgset=bg1&amp;size=200x200"</span>
<span class="p">)</span>
</code></pre></div></div>

<p>While this is an improvement, there is clearly some duplication that could be inefficient to maintain. For example, if we add a new column to one of tables we need to update all of the calls to <code class="highlighter-rouge">User.create</code> and <code class="highlighter-rouge">Item.create</code>. What if we want to create 1000 users and 10000 items?</p>

<p>Letâ€™s create a loop that will create the data instead. Itâ€™s also nice to know what our seed file is doing so weâ€™ll add a <code class="highlighter-rouge">puts</code> statement stating where we are at.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">10</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
  <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span>
    <span class="ss">name: </span><span class="no">Faker</span><span class="o">::</span><span class="no">Name</span><span class="p">.</span><span class="nf">name</span><span class="p">,</span>
    <span class="ss">email: </span><span class="no">Faker</span><span class="o">::</span><span class="no">Internet</span><span class="p">.</span><span class="nf">email</span>
    <span class="p">)</span>
  <span class="nb">puts</span> <span class="s2">"User </span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">user</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2"> - </span><span class="si">#{</span><span class="n">user</span><span class="p">.</span><span class="nf">email</span><span class="si">}</span><span class="s2"> created!"</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">100</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
  <span class="n">item</span> <span class="o">=</span> <span class="no">Item</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span>
    <span class="ss">name: </span><span class="no">Faker</span><span class="o">::</span><span class="no">Commerce</span><span class="p">.</span><span class="nf">product_name</span><span class="p">,</span>
    <span class="ss">description: </span><span class="no">Faker</span><span class="o">::</span><span class="no">Lorem</span><span class="p">.</span><span class="nf">paragraph</span><span class="p">,</span>
    <span class="ss">image_url: </span><span class="no">Faker</span><span class="o">::</span><span class="no">Avatar</span><span class="p">.</span><span class="nf">image</span>
    <span class="p">)</span>
  <span class="nb">puts</span> <span class="s2">"Item </span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">item</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2"> created!"</span>
<span class="k">end</span>
</code></pre></div></div>

<h2 id="iteration-3-object-oriented-seeds">Iteration 3: Object Oriented Seeds</h2>

<p>Many would stop here. Weâ€™re going to go one step further and make our seed file object oriented.</p>

<ul>
  <li>Create a <code class="highlighter-rouge">Seed</code> class.</li>
  <li>Create a method for each record generation (<code class="highlighter-rouge">generate_users</code>, <code class="highlighter-rouge">generate_items</code>, <code class="highlighter-rouge">generate_orders</code>)</li>
  <li>Create class method <code class="highlighter-rouge">start</code> that initializes the <code class="highlighter-rouge">Seed</code> class and generates the records</li>
</ul>

<p>Our final seed file should look something like this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># db/seeds.rb</span>

<span class="k">class</span> <span class="nc">Seed</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">start</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="no">Seed</span><span class="p">.</span><span class="nf">new</span>
    <span class="n">seed</span><span class="p">.</span><span class="nf">generate_users</span>
    <span class="n">seed</span><span class="p">.</span><span class="nf">generate_items</span>
    <span class="n">seed</span><span class="p">.</span><span class="nf">generate_orders</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">generate_users</span>
    <span class="mi">50</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
      <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span>
        <span class="ss">name: </span><span class="no">Faker</span><span class="o">::</span><span class="no">Name</span><span class="p">.</span><span class="nf">name</span><span class="p">,</span>
        <span class="ss">email: </span><span class="no">Faker</span><span class="o">::</span><span class="no">Internet</span><span class="p">.</span><span class="nf">email</span>
        <span class="p">)</span>
      <span class="nb">puts</span> <span class="s2">"User </span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">user</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2"> - </span><span class="si">#{</span><span class="n">user</span><span class="p">.</span><span class="nf">email</span><span class="si">}</span><span class="s2"> created!"</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">generate_items</span>
    <span class="mi">500</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
      <span class="n">item</span> <span class="o">=</span> <span class="no">Item</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span>
        <span class="ss">name: </span><span class="no">Faker</span><span class="o">::</span><span class="no">Commerce</span><span class="p">.</span><span class="nf">product_name</span><span class="p">,</span>
        <span class="ss">description: </span><span class="no">Faker</span><span class="o">::</span><span class="no">Lorem</span><span class="p">.</span><span class="nf">paragraph</span><span class="p">,</span>
        <span class="ss">image_url: </span><span class="no">Faker</span><span class="o">::</span><span class="no">Avatar</span><span class="p">.</span><span class="nf">image</span>
        <span class="p">)</span>
      <span class="nb">puts</span> <span class="s2">"Item </span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">item</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2"> created!"</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">generate_orders</span>
    <span class="mi">100</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
      <span class="n">user</span>  <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="no">Random</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">rand</span><span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">50</span><span class="p">))</span>
      <span class="n">order</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="nf">orders</span><span class="p">.</span><span class="nf">create!</span><span class="p">()</span>
      <span class="n">add_items</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
      <span class="nb">puts</span> <span class="s2">"Order </span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">: Order for </span><span class="si">#{</span><span class="n">user</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2"> created!"</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">add_items</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
    <span class="mi">10</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
      <span class="n">item</span> <span class="o">=</span> <span class="no">Item</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="no">Random</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">rand</span><span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">500</span><span class="p">))</span>
      <span class="n">order</span><span class="p">.</span><span class="nf">items</span> <span class="o">&lt;&lt;</span> <span class="n">item</span>
      <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">: Added item </span><span class="si">#{</span><span class="n">item</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2"> to order </span><span class="si">#{</span><span class="n">order</span><span class="p">.</span><span class="nf">id</span><span class="si">}</span><span class="s2">."</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Seed</span><span class="p">.</span><span class="nf">start</span>
</code></pre></div></div>

<h2 id="going-forward">Going Forward</h2>

<p>We challenge you to follow best OO practices in your seed file and to use the above as an example!</p>
:ET