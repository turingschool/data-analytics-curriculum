I"¬<h2 id="learning-goals">Learning Goals</h2>

<ul>
  <li>Understand the need for performance monitoring tools both in
development in production</li>
  <li>Practice installing and setting up newrelic in an example project</li>
  <li>Practice using the newrelic interface to pinpoint performance problems</li>
</ul>

<h2 id="structure">Structure</h2>

<ul>
  <li>25 - Discussion &amp; Initial NR Setup</li>
  <li>5 - Break</li>
  <li>25 - Newrelic practice</li>
  <li>5 - Wrapup</li>
</ul>

<h2 id="discussion---value-of-perfomance-monitoring">Discussion - Value of Perfomance Monitoring</h2>

<ul>
  <li>Everyone agrees that performance is important, but even with that aim
in mind, how do we know what parts of our app to focus on?</li>
  <li>To be able to improve it, you need to measure it.</li>
  <li>Or in other words: ‚ÄúOptimizing code without measuring it first
isn‚Äôt optimizing ‚Äì it‚Äôs just changing shit.‚Äù</li>
</ul>

<p><strong>Our Dreamy Performance Monitoring Tool</strong></p>

<p>What sort of things would we want out of our ideal benchmarking
tool?</p>

<ul>
  <li>Be able to see profiles based on actual production usage of the
app</li>
  <li>Be able to zoom in on an application trace to identify specific
methods or actions which are consuming the most time</li>
</ul>

<p>Fortunately, there are tools out there that give us a pretty
good implementation of these features. Newrelic and Skylight
are the most popular, and for this lesson we‚Äôll be looking at
Newrelic</p>

<h3 id="newrelic-advantages">Newrelic advantages</h3>

<p>A few nice things Newrelic gives us out of the gate include:</p>

<ul>
  <li>Ability to run it in development mode</li>
  <li>Greater detail in application traces to identify slow portions</li>
  <li>Application Histogram profiling (mean, TP90, TP95, etc)</li>
  <li>Ranking of all applicaiton actions by time consumption</li>
</ul>

<h2 id="workshop--adding-newrelic-to-an-application">Workshop ‚Äì Adding Newrelic to an application</h2>

<p>For this workshop, we‚Äôll look at adding newrelic to a sample
of the JSBlogger project. Since we‚Äôre interested in seeing
how Newrelic lets us monitor our performance in production as well,
we‚Äôll also want to push this project to a heroku instance and profile
it there.</p>

<h3 id="1-cloning--setup">1. Cloning / Setup</h3>

<p>Start by cloning the blogger project:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone -b postgres https://github.com/JumpstartLab/blogger_advanced.git performance_metrics
cd performance_metrics
bundle
bundle exec rake db:drop db:setup
</code></pre></div></div>

<h3 id="2-add-newrelic-to-the-project">2. Add Newrelic to the project</h3>

<p>First, add the newrelic agent to your gemfile:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gem 'newrelic_rpm'
</code></pre></div></div>

<p>and <code class="highlighter-rouge">bundle</code> the app.</p>

<h3 id="3-configuring-the-newrelic-agent">3. Configuring the Newrelic agent</h3>

<p>The Newrelic agent is a gem that will run in the background of our
application and send performance data up to newrelic‚Äôs servers
in realtime. But to get things to work, we need to have it configured
with a unique identifier and account for our app.</p>

<p>To acquire configuration for a newrelic app instance, visit
the <a href="http://newrelic.com/">newrelic homepage</a>, log in (you may need
to create a free account), and when you land on the ‚Äúapplications‚Äù page,
click the ‚ÄúAdd More‚Äù button. Click the ‚ÄúRuby‚Äù application setup button,
and when presented with the option, ‚ÄúDownload the newrelic.yml file.‚Äù</p>

<p>You need to move this configuration file into the <code class="highlighter-rouge">configuration</code>
directory of our rails project. This can usually be achieved by running:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mv ~/Downloads/newrelic.yml ./config
</code></pre></div></div>

<p>from the root directory of your rails app.</p>

<p>Once we have this setup, restart your app (on your local machine) and
start hitting a few pages. This should start sending some data to
your Newrelic instance.</p>

<p>If newrelic doesn‚Äôt automatically detect your application and redirect
you to its monitoring page, try to check for it manually by clicking
the ‚ÄúAPM‚Äù tab in the newrelic web interface. This should take you
to a listing of your registered newrelic applications, where your
JSBlogger instance should appear.</p>

<p>If everything goes smoothly, you should start
to see requests appearing in your Newrelic window.</p>

<h3 id="4-adding-load-for-better-performance-monitoring">4. Adding Load for Better Performance Monitoring</h3>

<p>Once we have Newrelic pulling in data from our application, we can
start to look at some more meaningful analysis of the data.</p>

<p>But what would be really helpful is to have a larger sample size of
requests to pull from. Fortunately this branch of the blogger
application includes a script for generating some artificial load.</p>

<p>In a new terminal window, start up the script by running (make sure
your server is seeded and running first):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rake load_script:run
</code></pre></div></div>

<h3 id="5-workshop--analyzing-newrelic-reporting">5. Workshop ‚Äì Analyzing Newrelic Reporting</h3>

<p>Students should follow along as the instructor gives a tour
of the Newrelic interface.</p>

<p>We‚Äôll focusing on:</p>

<ol>
  <li>Identifying the most expensive actions in our app</li>
  <li>Digging into an action to identify where it‚Äôs spending most of its
time</li>
  <li>Reading NR histograms to see percentage of time in DB/Ruby/GC/etc.</li>
</ol>
:ET