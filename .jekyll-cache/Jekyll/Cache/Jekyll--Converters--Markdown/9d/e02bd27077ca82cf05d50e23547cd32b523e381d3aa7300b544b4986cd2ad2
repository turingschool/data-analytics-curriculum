I"À<h1 id="iteration-4-merchant-analytics">Iteration 4: Merchant Analytics</h1>

<p>Our operations team is asking for better data about of our merchants and have asked for the following:</p>

<p>Assuming we have a <code class="highlighter-rouge">sales_engine</code> thatâ€™s an instance of <code class="highlighter-rouge">SalesEngine</code> letâ€™s initialize a <code class="highlighter-rouge">SalesAnalyst</code> like this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sales_analyst</span> <span class="o">=</span> <span class="n">sales_engine</span><span class="p">.</span><span class="nf">analyst</span>
</code></pre></div></div>

<p>Find out the total revenue for a given date:</p>

<div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sales_analyst</span><span class="p">.</span><span class="nf">total_revenue_by_date</span><span class="p">(</span><span class="n">date</span><span class="p">)</span> <span class="c1">#=&gt; $$</span>
</code></pre></div></div>
<p><strong>Note:</strong> When calculating revenue the <code class="highlighter-rouge">unit_price</code> listed within <code class="highlighter-rouge">invoice_items</code> should be used. The <code class="highlighter-rouge">invoice_item.unit_price</code> represents the final sale price of an item after sales, discounts or other intermediary price changes.</p>

<p>Find the top x performing merchants in terms of revenue:</p>

<div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sales_analyst</span><span class="p">.</span><span class="nf">top_revenue_earners</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="c1">#=&gt; [merchant, merchant, merchant, merchant, merchant]</span>
</code></pre></div></div>

<p>If no number is given for <code class="highlighter-rouge">top_revenue_earners</code>, it takes the top 20 merchants by default:</p>

<div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sales_analyst</span><span class="p">.</span><span class="nf">top_revenue_earners</span> <span class="c1">#=&gt; [merchant * 20]</span>
</code></pre></div></div>

<p>Which merchants have pending invoices:</p>

<div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sales_analyst</span><span class="p">.</span><span class="nf">merchants_with_pending_invoices</span> <span class="c1">#=&gt; [merchant, merchant, merchant]</span>
</code></pre></div></div>

<p><strong>Note:</strong> an invoice is considered pending if none of its transactions are successful.</p>

<p>Which merchants offer only one item:</p>

<div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sales_analyst</span><span class="p">.</span><span class="nf">merchants_with_only_one_item</span> <span class="c1">#=&gt; [merchant, merchant, merchant]</span>
</code></pre></div></div>

<p>And merchants that only sell one item by the month they registered (merchant.created_at):</p>

<div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sales_analyst</span><span class="p">.</span><span class="nf">merchants_with_only_one_item_registered_in_month</span><span class="p">(</span><span class="s2">"Month name"</span><span class="p">)</span> <span class="c1">#=&gt; [merchant, merchant, merchant]</span>
</code></pre></div></div>

<p>Find the total revenue for a single merchant:</p>

<div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sales_analyst</span><span class="p">.</span><span class="nf">revenue_by_merchant</span><span class="p">(</span><span class="n">merchant_id</span><span class="p">)</span> <span class="c1">#=&gt; $</span>
</code></pre></div></div>

<h1 id="the-following-two-methods-are-not-covered-by-the-spec-harness-as-a-group-write-a-blog-post-of-approximately-500-words-as-to-how-these-methods-work">The following two methods are not covered by the spec harness. As a group, write a blog post of approximately 500 words as to how these methods work.</h1>
<p>which item sold most in terms of quantity and revenue:</p>

<div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sales_analyst</span><span class="p">.</span><span class="nf">most_sold_item_for_merchant</span><span class="p">(</span><span class="n">merchant_id</span><span class="p">)</span> <span class="c1">#=&gt; [item] (in terms of quantity sold) or, if there is a tie, [item, item, item]</span>

<span class="n">sales_analyst</span><span class="p">.</span><span class="nf">best_item_for_merchant</span><span class="p">(</span><span class="n">merchant_id</span><span class="p">)</span> <span class="c1">#=&gt; item (in terms of revenue generated)</span>
</code></pre></div></div>
:ET