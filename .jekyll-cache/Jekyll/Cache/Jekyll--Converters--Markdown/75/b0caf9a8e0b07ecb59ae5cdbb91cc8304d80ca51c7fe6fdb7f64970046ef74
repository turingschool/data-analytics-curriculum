I"zU<h2 id="learning-goals">Learning Goals:</h2>

<p>By the end of this lesson, students:</p>

<ul>
  <li>understand what Webpack is and why it is useful</li>
  <li>can find their way around Webpack and its config</li>
  <li>are able to use Webpack for development, testing and production</li>
</ul>

<h2 id="slides">Slides</h2>

<p>Available <a href="../slides/webpack">here</a></p>

<h2 id="part-1-big-picture">Part 1: Big Picture</h2>

<h3 id="the-purpose-of-build-tools">The Purpose of Build Tools</h3>

<p>Let’s say you’re building a game in JavaScript and you’re new to this whole coding thing. Then let’s say that your HTML file looks like this:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;title&gt;</span>Webpack Demystified<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;h1&gt;</span>Hello, World.<span class="nt">&lt;/h1&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"bundle.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"game.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"thing.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"jquery.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"bootstrap.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"other-thing.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"something-else.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"stuff.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"ridiculous.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"ughhhhh.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>All of these JS files need to be loaded by your browser in a certain order, after the HTML is ready to go, or maybe before, depending on some details.</p>

<p>All of the CSS files need to be applied to your HTML, but not until the Sass compiler has done its job.</p>

<p>And don’t forget about the images or static asset files - those need to be pulled from the CSS files or maybe from the HTML code and stuck in their appropriate places relative to where the browser will render them.</p>

<p>All of that is a lot of stuff to worry about not only for the developer, but also for the browser. Debugging what went wrong can result in a bad time. Luckily for us, a variety of build tools have been developed that do all of the organizing for us.</p>

<p>Some of the main buzz words of you may have heard tossed around include Gulp, Grunt, or Webpack. These can have various labels like “Package Manager”, “Bundler”, or “Task Runner”. There are quite a few differences between them, but they all share a primary responsibility: <strong>Scan through all of your projects’ dependencies, handle any task that needs to be done prior to production, and ship it off in a neat little package that is easy for a browser to digest.</strong></p>

<h3 id="different-needs-in-different-environments">Different Needs in Different Environments</h3>

<p>We’ve talked about development, test and production environments before. The environment that’s best for us to code in is not the best environment for the browser to execute our code. Let’s dive into how we treat each of these environments differently.</p>

<p><strong>Developer Wants</strong></p>

<ul>
  <li>We like whitespace</li>
  <li>CSS is cumbersome we’d love to use Sass or LESS</li>
  <li>We use libraries of code others have written</li>
  <li>We write tests</li>
</ul>

<p><strong>Browser Needs</strong></p>

<ul>
  <li>Has to download files</li>
  <li>Can only process CSS and ES6, in some cases only ES5
    <ul>
      <li>JS is evolving faster than browsers are implementing it</li>
    </ul>
  </li>
  <li>There are lots of browsers and their needs differ</li>
</ul>

<h3 id="how-build-tools-bridge-the-gap">How Build Tools Bridge the Gap</h3>

<p>Let’s talk about some of the ways build tools (like Webpack and the Asset Pipeline) translate from development to production</p>

<ul>
  <li>Transpilers, like Babel, translate our easier-to-maintain code into code that the browser can interpret</li>
  <li>CSS preprocessors, like Sass or LESS, evaluate our SCSS files and write CSS the browser can interpret</li>
  <li>Minifiers remove whitespace, and can reduce variable name length</li>
</ul>

<h3 id="so-what-is-webpack">So What is Webpack?</h3>

<p>Webpack is a Node package that digs through your assets, finds dependencies, and spits out a single JS file that is ready for production.</p>

<p>What sets it apart is that <strong>it isn’t limited to only handling your JavaScript files</strong>. It thinks of everything else like a module as well. With Webpack you have access to <strong>loaders</strong> which preprocess your assets (like fonts, Sass, images, CSS, SVGs etc) and output exactly what your browser needs to know in the smallest package possible.</p>

<p>It also has some really cool features like <code class="highlighter-rouge">webpack-dev-server</code> which executes Webpack whenever you refresh your browser, or a thing called <code class="highlighter-rouge">hot-module-replacement</code> which tells your project to keep an eye on any changes, automatically refreshing your browser whenever it detects action.</p>

<p>Big picture: Webpack finds the starter file you’ve told it to use and crawls through the tree of dependencies in the appropriate order. It then minifies, optimizes, and loads anything it needs to make the browser happy.</p>

<h2 id="checks-for-understanding">Checks for Understanding</h2>

<ol>
  <li>Name a few things that build tools do. Why do we need those things?</li>
  <li>What are some build tools you’ve used before? Think about code that has been translated between environments.</li>
  <li>What kinds of things would we be forced to do in development if we didn’t have build tools?</li>
</ol>

<h2 id="part-2-webpack-tour">Part 2: Webpack Tour</h2>

<h3 id="install-some-command-line-tools">Install Some Command Line Tools</h3>

<p>We’ll need to install some tools both locally and globally so we have access to them everywhere all the time. Let’s start with global installation of Webpack itself, the Webpack Dev Server which will let us spin up a local server, and Mocha to kick-start our testing suite.</p>

<p><code class="highlighter-rouge">npm install -g webpack webpack-dev-server mocha</code></p>

<p>This will allow us to type <code class="highlighter-rouge">webpack</code>, <code class="highlighter-rouge">webpack-dev-server</code>, and <code class="highlighter-rouge">mocha</code> directly in our terminal whenever we need access to them.</p>

<blockquote>
  <p>To see what modules you have globally installed on your machine, type <code class="highlighter-rouge">npm list -g --depth=0</code> at any time in your terminal</p>
</blockquote>

<h3 id="setup-starter-kit">Setup Starter Kit</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone git@github.com:turingschool/qs-frontend-starter.git webpack-lesson
</code></pre></div></div>

<p>This will clone down the same repo that you’ll be using for your project, but will put it in a folder you can play around with for this lesson.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">install</span>
</code></pre></div></div>

<p>This will install all of the dependencies needed for development. Let’s peek into <code class="highlighter-rouge">package.json</code> to see what packages we’ve asked to be installed. Some you know about, some we’re about to talk about. What looks new?</p>

<h3 id="get-oriented">Get Oriented</h3>

<p>Let’s look at some of the files and directories we’ve created, and talk briefly about how we’re going to be using them.</p>

<ul>
  <li><code class="highlighter-rouge">webpack.config.js</code></li>
  <li><code class="highlighter-rouge">index.html</code> and <code class="highlighter-rouge">foods.html</code></li>
</ul>

<h3 id="webpack-config">Webpack Config</h3>

<p><code class="highlighter-rouge">webpack.config.js</code> is a file used to house all of your Webpack configurations.</p>

<p>At its most basic level, you’ll see something like this:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">entry</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">main</span><span class="p">:</span> <span class="dl">"</span><span class="s2">./index.js</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="na">output</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">filename</span><span class="p">:</span> <span class="dl">"</span><span class="s2">main.bundle.js</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="na">module</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">loaders</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span> <span class="na">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\.</span><span class="sr">js$/</span><span class="p">,</span> <span class="na">exclude</span><span class="p">:</span> <span class="sr">/node_modules/</span><span class="p">,</span> <span class="na">loader</span><span class="p">:</span> <span class="dl">'</span><span class="s1">babel-loader</span><span class="dl">'</span> <span class="p">},</span>
      <span class="p">{</span> <span class="na">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\.</span><span class="sr">css$/</span><span class="p">,</span> <span class="na">loader</span><span class="p">:</span> <span class="dl">"</span><span class="s2">style!css</span><span class="dl">"</span> <span class="p">},</span>
      <span class="p">{</span> <span class="na">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\.</span><span class="sr">scss$/</span><span class="p">,</span> <span class="na">loaders</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">style-loader</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">css-loader</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">sass-loader</span><span class="dl">"</span><span class="p">]</span> <span class="p">},</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This chunk of code tells Webpack to start at the <code class="highlighter-rouge">main</code> <code class="highlighter-rouge">entry</code> point and we’ve defined as <code class="highlighter-rouge">./index.js</code>. This is where we will write our code and require any other <code class="highlighter-rouge">.js</code> files that we need in our project. It will follow the tree of nested files and concatenate/minify/work some Webpack magic and <code class="highlighter-rouge">output</code> one single manageable file with the name of <code class="highlighter-rouge">main.bundle.js</code> which is what you’ll include in <code class="highlighter-rouge">&lt;script&gt;</code> tags in your <code class="highlighter-rouge">index.html</code> file.</p>

<h3 id="what-about-module--loaders-">What About <code class="highlighter-rouge">module: { loaders: ...}</code>?</h3>

<p>A <a href="https://webpack.js.org/concepts/loaders/">loader</a> is a per-file processor that deals with individual file types for you in the same way it handles <code class="highlighter-rouge">.js</code> files. Essentially Webpack thinks of everything in your project like a JavaScript module.</p>

<p>Think of loaders like a middle step. They make it possible for you as a developer to write your code in whatever language makes you happy, then when you’re ready to fire up your project, Webpack is like “hang on a sec…let me translate and organize all of this for you” and transpiles everything into a neat little bundle that your browser can render.</p>

<h3 id="html-files">HTML files</h3>

<p>As we’re mentally organizing our project with Webpack, it’s important to know that Webpack is not involved at all with your HTML. The benefit that Webpack gives us is a single JS file that we can load into our HTML. So let’s open up <code class="highlighter-rouge">index.html</code> and see what that looks like.</p>

<p>Notice the single <code class="highlighter-rouge">&lt;script&gt;</code> tag located before the closing <code class="highlighter-rouge">&lt;/body&gt;</code> tag. This is the epicenter of Webpack. Any <code class="highlighter-rouge">.js</code> file we write will be bundled along with any dependencies and sent to production as <code class="highlighter-rouge">bundle.js</code>.</p>

<h2 id="demo-webpack-in-action">Demo: Webpack In Action</h2>

<p>Make a new file in your <code class="highlighter-rouge">lib</code> directory called <code class="highlighter-rouge">alert.js</code> and export a simple alert function.</p>

<p><code class="highlighter-rouge">touch lib/alert.js</code></p>

<p><em>alert.js</em></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">Webpack, heck yeah!</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Then require said file and call the function in our entry <code class="highlighter-rouge">index.js</code> file.</p>

<p><em>index.js</em></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">newAlert</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./alert</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">newAlert</span><span class="p">();</span>
</code></pre></div></div>

<p>Now open up <code class="highlighter-rouge">index.html</code></p>

<p><code class="highlighter-rouge">open index.html</code></p>

<p>….buzzkill. No alert. But this shouldn’t be a surprise because we haven’t actually told Webpack to bundle our stuff yet. Do that now:</p>

<p><code class="highlighter-rouge">webpack</code></p>

<p>This will run Webpack using the defined config, and modify our <code class="highlighter-rouge">main.bundle.js</code>. Then try refreshing the page, or just type <code class="highlighter-rouge">open index.html</code> again.</p>

<h3 id="time-to-automate">Time to Automate!</h3>

<p>We’re getting closer, but think about our development flow. Do we want to have to run <code class="highlighter-rouge">webpack</code> and refresh the page every time we want to see our code changes in the browser?</p>

<p>Luckily, there’s a handy helper called <code class="highlighter-rouge">webpack-dev-server</code> that we mentioned earlier. This will boot up a development server and run our configuration file and reload our changes anytime we refresh our browser. Try it out!</p>

<p><code class="highlighter-rouge">webpack-dev-server</code></p>

<p>Then visit <code class="highlighter-rouge">http://localhost:8080</code></p>

<p>Make a change to your <code class="highlighter-rouge">alert.js</code> file and go back to your browser.</p>

<h3 id="styling">Styling</h3>

<p>Webpack also allows you to require styling, like <code class="highlighter-rouge">.css</code> and <code class="highlighter-rouge">.scss</code> files the same way you would any other <code class="highlighter-rouge">.js</code> file. Behind the scenes, it’s taking all your CSS and appending it to your HTML at the time the JS file is read in. It’s kind of a hack, but it allows you to have just a single <code class="highlighter-rouge">.js</code> file that loads all your logic and styling in one go.</p>

<h4 id="you-do-loading-styles-with-webpack">You Do: Loading Styles with Webpack</h4>

<p>Try creating a really simple <code class="highlighter-rouge">styles.scss</code> file in your <code class="highlighter-rouge">lib</code> folder that contains the following:</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">body</span> <span class="p">{</span>
  <span class="nl">background-color</span><span class="p">:</span> <span class="no">tomato</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now require it in <code class="highlighter-rouge">lib/index.js</code>. You don’t need to assign the return value of require to anything. You just need that require line for Webpack to load it:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./styles.scss</span><span class="dl">'</span><span class="p">)</span>
</code></pre></div></div>

<p>Check out that webpack magic in the browser!</p>

<h3 id="deployment">Deployment</h3>

<p>Let’s look at the <a href="https://github.com/turingschool/qs-frontend-starter#github-pages-setup">GitHub Pages Section</a> of the starter kit README.</p>

<h2 id="checks-for-understanding-1">Checks for Understanding</h2>

<ol>
  <li>What steps do you need to take before you can start developing with Webpack?</li>
  <li>What is your development process once Webpack is setup?</li>
  <li>What is your deployment process when using Webpack?</li>
</ol>

<h3 id="bonus-using-packagejson-scripts">Bonus: Using package.json Scripts</h3>

<p><code class="highlighter-rouge">package.json</code> makes it easier to run commands. Let’s make a few changes so we can keep shortcut some terminal commands.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// package.json</span>
<span class="p">...</span>
<span class="dl">"</span><span class="s2">scripts</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
  <span class="dl">"</span><span class="s2">start</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">./node_modules/webpack-dev-server/bin/webpack-dev-server.js  --hot --inline</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">build</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">./node_modules/webpack/bin/webpack.js</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">test</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">./node_modules/mocha/bin/mocha --compilers js:babel-core/register</span><span class="dl">"</span>
<span class="p">},</span>
<span class="p">...</span>
</code></pre></div></div>

<p>This lets us use handy <code class="highlighter-rouge">npm</code> commands such as <code class="highlighter-rouge">npm start</code> to fire up webpack-dev-server, <code class="highlighter-rouge">npm run build</code> to package everything for production, and <code class="highlighter-rouge">npm test</code> to execute our testing suite.</p>

<p>The <code class="highlighter-rouge">--hot --inline</code> flags tell npm to watch for any changes and reload automatically.</p>

<p>Why <code class="highlighter-rouge">npm run build</code> instead of just <code class="highlighter-rouge">npm build</code>? <a href="https://stackoverflow.com/questions/29939697/npm-build-doesnt-run-the-script-named-build-in-package-json">NPM has a built in build command</a>, which is not what we want to run in this case.</p>

<h2 id="additional-resources">Additional Resources</h2>

<ul>
  <li><a href="https://webpack.js.org/">Webpack Docs</a></li>
  <li><a href="http://code.tutsplus.com/series/introduction-to-webpack--cms-983">Awesome Webpack Blog Post</a></li>
  <li><a href="https://npmcompare.com/compare/browserify,grunt,gulp,webpack">Comparing Browserify/Grunt/Gulp/Webpack</a></li>
  <li><a href="http://survivejs.com/webpack/developing-with-webpack/getting-started/">Another Webpack Tutorial</a></li>
</ul>
:ET