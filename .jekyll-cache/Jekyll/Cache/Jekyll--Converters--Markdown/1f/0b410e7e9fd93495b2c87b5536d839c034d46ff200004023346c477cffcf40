I"‡<h2 id="goals">Goals</h2>

<ul>
  <li>Understand what Factory Girl does</li>
  <li>Use Factory Girl documentation to set up factories in an existing product</li>
</ul>

<h2 id="warmup-10-minutes">Warmup (10 minutes)</h2>

<p>Visit the following <a href="https://github.com/s-espinosa/bike-share/blob/testing_sample/spec/models/example_spec.rb">link</a>.</p>

<ul>
  <li>Describe whatâ€™s happening in the setup in non-technical language.</li>
</ul>

<h2 id="introducing-factory-girl-5-minutes">Introducing Factory Girl (5 minutes)</h2>

<p>Is there a better way to do this? Factory Girl could help us out.</p>

<p>Clone the project <a href="https://github.com/s-espinosa/guaranty_bank_500">here</a> and letâ€™s take a look at the spec folder.</p>

<h3 id="overview">Overview</h3>

<p>A factory is an object whose job it is to create other objects. Whatâ€™s the purpose of Factory Girl? Check out <a href="http://stackoverflow.com/questions/5183975/factory-girl-whats-the-purpose">this StackOverflow answer</a>.</p>

<p>It comes with some fancy tricks to allow you to set default parameters, override those parameters, create multiples of a particular object, etc.</p>

<p>You can use it in your test as follows:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">station</span>         <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:station</span><span class="p">)</span>
<span class="n">invalid_station</span> <span class="o">=</span> <span class="n">create</span><span class="p">(</span><span class="ss">:station</span><span class="p">,</span> <span class="ss">city_id: </span><span class="kp">nil</span><span class="p">)</span>
<span class="n">three_stations</span>  <span class="o">=</span> <span class="n">create_list</span><span class="p">(</span><span class="ss">:station</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="testing-guaranty-bank-500-15-minutes">Testing Guaranty Bank 500 (15 minutes)</h2>

<p>The application that youâ€™ve cloned is meant to eventually track cars, owners, drivers, and their races. Currently, functionality has been built to allow users to create Owners, Cars, and Drivers, as well as calculating the average maximum speed for a collection of cars.</p>

<p>We also have some basic testing. Letâ€™s see how we can use Factory Girl to create information for our tests. Currently there are three skipped tests. Letâ€™s start with the test for a car.</p>

<h3 id="discuss-car-factory-10-minutes">Discuss: <code class="highlighter-rouge">:car</code> Factory (10 minutes)</h3>

<p>In the application that youâ€™ve cloned, take a look at the <code class="highlighter-rouge">spec/models/car_spec.rb</code> and <code class="highlighter-rouge">spec/models/car_fg/spec.rb</code> files. While our <code class="highlighter-rouge">:race</code> factory was so simple as to not be useful, here we can see how Factory Girl can actually save us work.</p>

<p>Below is the setup for the first <code class="highlighter-rouge">.average_max_speed</code> test without using Factory Girl.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  owner  = Owner.create(name: "Scrooge McDuck")
  driver = Driver.create(name: "Baloo")
  Car.create(owner: owner, driver: driver, max_speed: 1, monetary_value: 2)
  Car.create(owner: owner, driver: driver, max_speed: 2, monetary_value: 2)
</code></pre></div></div>

<p>Compare that to the same setup in the <code class="highlighter-rouge">.average_max_speed</code> setup in the first test of the <code class="highlighter-rouge">car_fg_spec.rb</code> file.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  car1, car2 = create_list(:car, 2)
</code></pre></div></div>

<p>Behind the scenes, this one line is also creating an Owner and a Driver, but since those items are not pertinent to the test at hand Factory Girl allows us to just create them as valid instances of those things. Additionally, since the <code class="highlighter-rouge">monetary_value</code> of these cars is not important to the test at hand, we use Factory Girl to create cars with valid attributes without worrying about specifying their value.</p>

<p>We can also specify certain values by passing an additional argument:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  car1, car2 = create_list(:car, 2, max_speed: 4)
</code></pre></div></div>

<p>Or create single instances using a <code class="highlighter-rouge">create</code> method:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>car1 = create(:car)
car2 = create(:car)
</code></pre></div></div>

<p>If we want to create a single instance with specific attributes, we can pass those as additional arguments as well:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>car1 = create(:car, max_speed: 4)
car2 = create(:car, max_speed: 6)
</code></pre></div></div>

<h3 id="code-along-create-a-race-factory-5-minutes">Code Along: Create a <code class="highlighter-rouge">:race</code> Factory (5 minutes)</h3>

<p>Create a Factory for <code class="highlighter-rouge">race</code> that returns 2015 as the year. Also, in the second test in that file, find a way to use the same Factory, but specifying a different year.</p>

<h2 id="with-a-partner-create-an-owner_with_cars-factory-20-minutes">With a Partner: Create an <code class="highlighter-rouge">owner_with_cars</code> Factory (20 minutes)</h2>

<p>Using the documentation availabile <a href="http://www.rubydoc.info/gems/factory_girl/file/GETTING_STARTED.md">here</a>, create a factory called <code class="highlighter-rouge">:owner_with_cars</code> that creates an owner with 3 cars by default. Use this factory to make the remaining skipped test pass.</p>

<h2 id="share-10-minutes">Share (10 minutes)</h2>

<h2 id="additional-time">Additional Time</h2>

<ul>
  <li>Implement a <code class="highlighter-rouge">#max_car_speed</code> method on driver that finds the maximum speed of all of the cars they drive.</li>
  <li>Test this using Factory Girl by creating a <code class="highlighter-rouge">:driver_with_cars</code> Factory</li>
</ul>

<h3 id="further-reading">Further Reading</h3>

<ul>
  <li><a href="http://www.rubydoc.info/gems/factory_girl/file/GETTING_STARTED.md">Getting Started with Factory Girl</a></li>
</ul>
:ET