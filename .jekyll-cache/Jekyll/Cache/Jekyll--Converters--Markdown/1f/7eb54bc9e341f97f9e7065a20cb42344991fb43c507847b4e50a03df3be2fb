I"ªf<h2 id="learning-goals">Learning Goals</h2>

<ul>
  <li>Understand event bubbling</li>
  <li>Learn to use event bubbling to set event listeners</li>
</ul>

<h2 id="vocabulary">Vocabulary</h2>

<ul>
  <li>event</li>
  <li>DOM</li>
  <li>DOM node</li>
  <li>event listener</li>
  <li>capture, target, bubble</li>
  <li>child, parent, grandparent</li>
</ul>

<h2 id="warm-up">Warm Up</h2>

<ul>
  <li>When thinking about front-end interactions, what is an event?</li>
  <li>What are some events that typically take place on a webpage?##</li>
  <li>What is the DOM?</li>
</ul>

<h2 id="event-basics">Event Basics</h2>

<p>Events are happening all the time in the browser. When the browser has finished loading the page, an event is fired. Every time the user moves their mouse, hovers over an element, clicks or taps, submits a form, presses down on a key or takes their finger off that key ‚Äî an event is fired. Some of these events are very easy to spot when they occur (e.g. the user clicks on a hyperlink), but many go by completely unnoticed.</p>

<p>It is, however, possible for us to use JavaScript to set up listeners for events that interest us. Our listeners wait patiently on a DOM node until the event they‚Äôre waiting for is fired. Then, they spring into action, running an appropriate function to respond to the event as required, or whatever else you deem appropriate.</p>

<p>For a review of how to set event listeners, please refer to the <a href="http://frontend.turing.io/lessons/module-1/js-3-dom-manipulation.html">Introduction to JavaScript III - Intro to DOM Manipulation</a></p>

<h2 id="things-to-know">Things to know</h2>

<p>Event propagation is an important yet misunderstood topic/term when talking about events. Event propagation is an overarching term that includes the three different phases of DOM Events: capturing, targeting, and bubbling. Event propagation is bi-directional (starts at the window‚Ä¶ goes to the target‚Ä¶ and ends at the window) and is often improperly used as a synonym for event bubbling. Every time an event occurs, event propagation is occurring behind the scenes.</p>

<ul>
  <li><strong>Event capture phase</strong> - When an event occurs in the DOM, notification of the event is passed starting at the top of the DOM tree and passing down through all parent element nodes all the way to the target node where the event occurred.</li>
  <li><strong>Event target phase</strong> - After the capturing phase occurs, the Target phase occurs. The target phase only includes a notification of Node where the event took place.</li>
  <li><strong>Event bubbling phase</strong> - This is the final phase to occur, although many people think this is the first phase. In the bubbling phase a notice is passed from the target Node up through all of the parent Nodes all the way back to the top root of the DOM</li>
</ul>

<h2 id="event-bubbling">Event Bubbling</h2>

<p>Now we‚Äôve talked about the very basics of events, let‚Äôs turn our attention to event bubbling, which refers to the ability of events set on DOM nodes to ‚Äúbubble up‚Äù and also apply to children of those nodes. We‚Äôll start with a quick experiment.</p>

<h3 id="experiment">Experiment</h3>

<p>In the following code pen, we have three nested HTML elements in <code class="highlighter-rouge">index.html</code>:</p>

<p data-height="265" data-theme-id="0" data-slug-hash="pLvGMM" data-default-tab="css,result" data-user="ameseee" data-embed-version="2" data-pen-title="Event Bubbling" class="codepen">See the Pen <a href="https://codepen.io/ameseee/pen/pLvGMM/">Event Bubbling</a> by Amy Holt (<a href="https://codepen.io/ameseee">@ameseee</a>) on <a href="https://codepen.io">CodePen</a>.</p>
<script async="" src="https://static.codepen.io/assets/embed/ei.js"></script>

<h3 id="small-group-practice">Small Group Practice</h3>

<p>Visit the <a href="https://codepen.io/ameseee/pen/pLvGMM">this page</a> and fork the CodePen.</p>

<p>Follow your group‚Äôs directions, then answer the following questions:</p>
<ul>
  <li>What is the result when you click on the button?</li>
  <li>What is is the result when you click the <code class="highlighter-rouge">.parent</code> element?</li>
  <li>What is is the result when you click the <code class="highlighter-rouge">.grandparent</code> element?</li>
</ul>

<p>Refactor any code you wrote.</p>

<p>Draw a diagram to explain what is happening and write your code out on your poster!</p>

<p><strong>Groups 1, 4:</strong></p>
<ul>
  <li>Add a click event to the button that logs or alerts:</li>
  <li><code class="highlighter-rouge">this</code></li>
  <li>event.target</li>
  <li>event.currentTarget</li>
</ul>

<p><strong>Groups 2, 5:</strong></p>
<ul>
  <li>Add a click event to the <code class="highlighter-rouge">.parent</code> element that logs or alerts:</li>
  <li><code class="highlighter-rouge">this</code></li>
  <li>event.target</li>
  <li>event.currentTarget</li>
</ul>

<p><strong>Groups 3, 6:</strong></p>
<ul>
  <li>Add a click event to the <code class="highlighter-rouge">.grandparent</code> element that logs or alerts:</li>
  <li><code class="highlighter-rouge">this</code></li>
  <li>event.target</li>
  <li>event.currentTarget</li>
</ul>

<h3 id="partner-experiment">Partner Experiment</h3>

<p>You may have noticed that the event listeners on a parent element are fired whenever the action occurs on one of its children.</p>

<p>When an event occurs, the browser checks the element to see if there are any event listeners registered. After it checks the element where the event occurred, the browser works its way up the DOM tree to see if any of the parents have a listener registered, then grandparents, and so on. It checks every element all the way up to the root (see <code class="highlighter-rouge">event.path</code>). This process is known as <em>event bubbling</em>.</p>

<p>Try out the following code in your forked CodePen:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">.grandparent</span><span class="dl">'</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Grandparent</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">.parent</span><span class="dl">'</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Parent</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#click-me</span><span class="dl">'</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Button</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">});</span>
</code></pre></div></div>

<h4 id="turn--talk">Turn &amp; Talk</h4>
<ul>
  <li>What happens when the button is clicked, and why? What technical vocabulary help you explain that.</li>
  <li>What happens when the grandparent is clicked? Why is that all that happens?</li>
</ul>

<h3 id="why-do-we-care">Why Do We Care?</h3>

<p><img src="./assets/event_example.png" alt="inline" /></p>

<p>In the screenshot above, the ‚ÄúRecent Selections‚Äù card has a table-like structure, where each row has data and several buttons. What can‚Äôt be illustrated in a screenshot is that the row itself can be clicked on to be expanded. Turing, Imperatives, and the two icons on the right can also be clicked on to navigate to another screen.</p>

<p>In your notebook, write your answers/sketch out:</p>
<ul>
  <li>What relationship does the row have to the icons?</li>
  <li>Which nodes need an event listener?</li>
  <li>Where may event bubbling cause a problem? What would the experience be like for the user?</li>
</ul>

<h3 id="the-event-object">The Event Object</h3>

<p>The anonymous function passed to <code class="highlighter-rouge">$(selector).on('click', function(){})</code> takes an optional argument, which it assigns an <code class="highlighter-rouge">Event</code> object to. In the case of the click event we‚Äôve been using as an example, this is a <code class="highlighter-rouge">MouseEvent</code>. You can visit <a href="https://developer.mozilla.org/en-US/docs/Web/API/Event">the MDN page for <code class="highlighter-rouge">Event</code></a> to explore the full list of supported event types.</p>

<p>Each type of event supports a number of different properties. <code class="highlighter-rouge">MouseEvent</code> has information about the <code class="highlighter-rouge">x</code> and <code class="highlighter-rouge">y</code> coordinates where the mouse was clicked. <code class="highlighter-rouge">KeyboardEvent</code> has information about which key was pressed. The <code class="highlighter-rouge">target</code> and <code class="highlighter-rouge">currentTarget</code> properties on the <code class="highlighter-rouge">Event</code> object can be useful during the event bubbling phase.</p>

<p>The <code class="highlighter-rouge">target</code> property represents the node that actually triggered the event, whereas <code class="highlighter-rouge">currentTarget</code> is the node that is <em>listening</em> for the event. Sometimes, <code class="highlighter-rouge">target</code> and <code class="highlighter-rouge">currentTarget</code> are the same node, but not <em>always</em>.</p>

<p>For example, if a <code class="highlighter-rouge">div</code> listens for a <code class="highlighter-rouge">click</code> event, a child <code class="highlighter-rouge">button</code> of the
<code class="highlighter-rouge">div</code> is clicked, the <code class="highlighter-rouge">target</code> would be the <code class="highlighter-rouge">button</code>, and the <code class="highlighter-rouge">currentTarget</code>
would be the <code class="highlighter-rouge">div</code>.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- index.html --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"submit"</span><span class="nt">&gt;</span>Submit<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// scripts.js</span>
<span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">.container</span><span class="dl">"</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">);</span> <span class="c1">// With only one event listener registered,</span>
      <span class="c1">// this will always be the div.container node</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">);</span> <span class="c1">// if you click the button, this will be the</span>
      <span class="c1">// button.submit node</span>
      <span class="c1">// if you click outside of the button, but still in the .container space,</span>
      <span class="c1">// it will log the div.container node</span>
  <span class="p">});</span>
</code></pre></div></div>

<p>Let‚Äôs make some changes to the code from earlier. Instead of logging a description of each element where an event was triggered, either by a click or through event bubbling, let‚Äôs log the <code class="highlighter-rouge">target</code> and <code class="highlighter-rouge">currentTarget</code> of the event.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">.grandparent</span><span class="dl">'</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">target</span><span class="dl">"</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">currentTarget</span><span class="dl">"</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">.parent</span><span class="dl">'</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">target</span><span class="dl">"</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">currentTarget</span><span class="dl">"</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#click-me</span><span class="dl">'</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">target</span><span class="dl">"</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">currentTarget</span><span class="dl">"</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<h2 id="stop--refactor">STOP &amp; REFACTOR</h2>

<p>Just because we are in JavaScriptopolis doesn‚Äôt mean we have to write WET (‚ÄúWoo! Extra Typing!‚Äù) code! In the interest of always keeping an eye out for repetitive tasks, let‚Äôs see that previous snippet refactored with a <code class="highlighter-rouge">forEach</code> call:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">selectors</span> <span class="o">=</span> <span class="p">[</span><span class="dl">"</span><span class="s2">.grandparent</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">.parent</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">#click-me</span><span class="dl">"</span><span class="p">];</span>

<span class="nx">selectors</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">selector</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$</span><span class="p">(</span><span class="nx">selector</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">target</span><span class="dl">"</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">currentTarget</span><span class="dl">"</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>

<h2 id="back-to-events">Back to Events</h2>

<h3 id="adding-and-removing-event-listeners">Adding and Removing Event Listeners</h3>

<p>A common obstacle that many JavaScript developers struggle with is understanding the timing in which they bind event listeners to DOM nodes. When we add event listeners to DOM nodes, we‚Äôre only adding them to the nodes that are currently on the page. We are <em>not</em> adding listeners to nodes that may be added to the page in the future.</p>

<h3 id="experiment-1">Experiment</h3>

<p data-height="265" data-theme-id="0" data-slug-hash="pLvYrj" data-default-tab="js,result" data-user="ameseee" data-embed-version="2" data-pen-title="Events: Event Delegation" class="codepen">See the Pen <a href="https://codepen.io/ameseee/pen/pLvYrj/">Events: Event Delegation</a> by Amy Holt (<a href="https://codepen.io/ameseee">@ameseee</a>) on <a href="https://codepen.io">CodePen</a>.</p>
<script async="" src="https://static.codepen.io/assets/embed/ei.js"></script>

<p>You should see 2 tasks in our To-do List labeled ‚ÄúTask 1‚Äù and ‚ÄúTask 2‚Äù as well as a button for adding new tasks to our list.</p>

<ol>
  <li>Click each of the tasks in our list and verify that each one fires an <code class="highlighter-rouge">alert</code> notifying you that the <code class="highlighter-rouge">li</code> element has in fact been clicked.</li>
  <li>Add an additional task using the ‚ÄúAdd new task‚Äù button.</li>
  <li>Click on the new task and observe the results.</li>
</ol>

<p>What did you notice? What is your prediction about why this is happening?</p>

<p>The event listeners are only bound to the li elements that were present when the page code was first loaded. The li elements we added later were not around when we added the listeners.</p>

<p><strong>What could we do to fix this?</strong></p>

<p>Work with your partner to modify the function that adds new buttons so that it adds an event listener to the element before appending it to the page. Some googling will probably be involved.</p>

<h2 id="event-delegation">Event Delegation</h2>

<p>Setting event listeners on specific newly created DOM nodes is one way to set event listeners. However, if you‚Äôre not careful, you may end up setting multiple listeners on the same node.</p>

<p>Also, you can cause a <a href="http://javascript.crockford.com/memory/leak.html">memory leak</a> if an event listeners are not unbound from an element when it is removed from the DOM.</p>

<p>Rather than manage the addition and removal of event listeners, there is a methodology you can use called <em><strong>event delegation</strong></em>.</p>

<p>In <em><strong>event delegation</strong></em>, we take advantage of the fact that events bubble in the event loops by setting an event listener on one parent. This event listener analyzes bubbled events to find a match in its child elements.</p>

<p>From the jQuery documentation: ‚ÄúEvent delegation refers to the process of using event propagation (bubbling) to handle events at a higher level in the DOM than the element on which the event originated. It allows us to attach a single event listener for elements that exist now or in the future.‚Äù</p>

<p>Event delegation in tandem with <code class="highlighter-rouge">target</code> and <code class="highlighter-rouge">currentTarget</code> allows you to have more articulate control over what events actually execute your JavaScript.</p>

<h2 id="extra-enough-with-the-bubbles">Extra: Enough with the Bubbles</h2>

<p>You have already come across <code class="highlighter-rouge">event.preventDefault()</code>, which does exactly what its name implies.</p>

<p>In the context of event bubbling and delegation, there is another function on the <code class="highlighter-rouge">Event</code> object that is useful for controlling event flow:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">event</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
</code></pre></div></div>

<p>As you might expect, this prevents the event from traveling up the ancestral node path.</p>

<p>This is helpful if a parent and child both have listeners, but should be executed in different contexts.</p>

<blockquote>
  <p>I never thought I would ever say the words ‚Äúancestral node path‚Äù.</p>
</blockquote>

<p>Coming back to this generic logging example, what happens if you stop propagation after the <code class="highlighter-rouge">console.log()</code> lines?</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">selectors</span> <span class="o">=</span> <span class="p">[</span><span class="dl">"</span><span class="s2">.grandparent</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">.parent</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">#click-me</span><span class="dl">"</span><span class="p">];</span>

<span class="nx">selectors</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">selector</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$</span><span class="p">(</span><span class="nx">selector</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">target</span><span class="dl">"</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">currentTarget</span><span class="dl">"</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">);</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Click around the DOM to see the results.</p>

<h2 id="review">Review</h2>

<ul>
  <li>What is the DOM?</li>
  <li>List two different events that can occur on the DOM.</li>
  <li>What is an event listener?</li>
  <li>When an element is bound to a listener, what besides that element can trigger an event?</li>
  <li>What does event bubbling or event propagation mean?</li>
</ul>
:ET