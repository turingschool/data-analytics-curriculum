I"˛o<h2 id="learning--completion-goals">Learning &amp; Completion Goals</h2>

<h3 id="environment-variables">Environment Variables</h3>

<ul>
  <li>Student can explain the role and usage of a shell profile like <code class="highlighter-rouge">.bash_profile</code></li>
  <li>Student can define environment variables in a shell profile</li>
  <li>Student can access environment variables from a running Ruby process</li>
  <li>Student can define environment variables in a Heroku application</li>
  <li>Student can access environment variables on a running Heroku application</li>
</ul>

<h3 id="environments-in-rails">Environments in Rails</h3>

<ul>
  <li>Student can use the environment configuration files to define per-environment settings</li>
  <li>Student can use command-line flags to set the application environment</li>
  <li>Student can explain how the database.yml works with the application environment to allow for per-environment settings</li>
</ul>

<h2 id="session-plan">Session Plan</h2>

<h3 id="schedule">Schedule</h3>

<p>Recapping what goes into a local dev environment, staging, production.</p>

<h3 id="part-1-shell-profile">Part 1: Shell Profile</h3>

<p>What are environment variables? Environment (<code class="highlighter-rouge">ENV</code> or <code class="highlighter-rouge">env</code>) variables are name=value pairs set to dynamically describe the environment a machine and or program is going to run in. These values can dictate the way a program will run. Let‚Äôs look at a common environment variable, <code class="highlighter-rouge">PATH</code> or <code class="highlighter-rouge">$PATH</code>. You often see <code class="highlighter-rouge">env</code> variable mentioned with a <code class="highlighter-rouge">$</code> because the dollar sign is the SHELL syntax to refer to a variable. <code class="highlighter-rouge">PATH</code> and <code class="highlighter-rouge">$PATH</code> are referring to the same variable.</p>

<h4 id="investigating-variables">Investigating Variables</h4>

<p>Let‚Äôs explore a few commands to help us investigate the environment variables.</p>

<p>You can see the values of your variables by running the command ,<code class="highlighter-rouge">env</code> in your terminal. The command <code class="highlighter-rouge">printenv</code> will show you the same output. Another command you can use to investigate the environment is <code class="highlighter-rouge">set</code>. The <code class="highlighter-rouge">set</code> command will return to you all env functions and their values too and this can be a little verbose. You can run <code class="highlighter-rouge">set | less</code> to see the output without all the functions. All three of these commands generally give you the same output.</p>

<p>Spend a minute or two investigating these commands:</p>

<ul>
  <li><code class="highlighter-rouge">env</code></li>
  <li><code class="highlighter-rouge">printenv</code></li>
  <li><code class="highlighter-rouge">set</code></li>
  <li><code class="highlighter-rouge">set | less</code></li>
</ul>

<p>These command allow us to see all the environment variables. If you want to investigate a single variable you can use the <code class="highlighter-rouge">echo</code> command referring to the shell variable (ex: $SHELL). Try this: <code class="highlighter-rouge">echo $SHELL</code> and or <code class="highlighter-rouge">echo $PATH</code>. You will also most likely have variables for $TERM and $USER if you want to look at these.</p>

<h4 id="setting-and-unsetting-temporary-variables">Setting and Unsetting Temporary Variables</h4>

<p>Now that we know how to investigate current environment variables, we can look at declaring new, or overriding existing variables temporarily. The <code class="highlighter-rouge">HOME</code> variable is a common env variable we should all have. It declares what is the root of your machine. Mine for example is <code class="highlighter-rouge">/Users/Carmer</code>. If I navigate to my machines home or root ( <code class="highlighter-rouge">cd</code> or <code class="highlighter-rouge">cd ~</code>), I will be taken to <code class="highlighter-rouge">/User/Carmer</code>. You can temporarily override this, and any variable in the command line.</p>

<p>Setting variables is done with the <code class="highlighter-rouge">export</code> command. If we want to override the <code class="highlighter-rouge">HOME</code> variable, we can do that with the command <code class="highlighter-rouge">export HOME=/Path/I/Want/To/NavigateTo</code>. I‚Äôll temporarily change mine to the desktop <code class="highlighter-rouge">/Users/Carmer/Desktop</code>.</p>

<ul>
  <li><code class="highlighter-rouge">export HOME=/Users/$USER/Desktop</code></li>
</ul>

<p>You could change this to any directory you‚Äôd like. Keep in mind we are currently setting <em>TEMPORARY VARIABLES</em> for the current shell only. That means that a different window in your terminal will not have these values. Also, once you close your terminal or shell session you will lose these variables. You can see this in action:</p>

<p>In one window run:</p>

<ul>
  <li><code class="highlighter-rouge">echo $HOME</code></li>
  <li><code class="highlighter-rouge">export HOME=/Users/$USER/Desktop</code></li>
  <li><code class="highlighter-rouge">echo $HOME</code></li>
</ul>

<p>You should see the output of the echo command change to <code class="highlighter-rouge">/Users/Carmer/Desktop</code>. Now open a new terminal window with <code class="highlighter-rouge">command t</code> or up in the menu bar with Shell -&gt; New Window.</p>

<p>If you run <code class="highlighter-rouge">echo $HOME</code> now, you will see the $HOME variable is back to it‚Äôs original value. You can even flip back to the old window and see the temporary value is still what you changed it too.</p>

<p>Alternatively we can set completely new variables too. Let‚Äôs play around with this a little.</p>

<p>Use the export command to set some random variables. Then use the commands that we learned to investigate the values that we set:</p>

<p>example: <code class="highlighter-rouge">export RANDOMVARIABLENAME="HellowWOWOWOWVariable"</code></p>

<p>To unset or remove a temporary environment variable you can use the <code class="highlighter-rouge">unset</code> command followed by the Shell variable name you want to unset. <code class="highlighter-rouge">unset $RANDOMVARIABLENAME</code>.</p>

<p>We can manipulate these variables in Ruby too. In any ruby program we can access the environment variables with <code class="highlighter-rouge">ENV</code>. <code class="highlighter-rouge">ENV</code> is an Object in ruby and you can interact with it just like a hash with strings as keys. <code class="highlighter-rouge">ENV["key"] = "Value"</code>.</p>

<p>Let‚Äôs play in IRB for a minute. Open an IRB session in your terminal with the command <code class="highlighter-rouge">irb</code>.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">001</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span>
<span class="sb">`loop{ sleep 3; puts "The variable HOME is </span><span class="si">#{</span><span class="no">ENV</span><span class="p">[</span><span class="s1">'HOME'</span><span class="p">]</span><span class="si">}</span><span class="sb">" }`</span>
</code></pre></div></div>

<p>In this example we are looking at the environment variable HOME. We can see that this is the same variable that we looked at through our terminal without ruby.</p>

<p>Now let‚Äôs try an experiment. Open <code class="highlighter-rouge">irb</code> and run the following:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">001</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="no">ENV</span><span class="p">[</span><span class="s2">"MARKER"</span><span class="p">]</span>
<span class="o">=&gt;</span> <span class="kp">nil</span>
</code></pre></div></div>

<p>We can see MARKER is currently <code class="highlighter-rouge">nil</code>. Now go ahead and export a value for the variable <code class="highlighter-rouge">MARKER</code>. Whatever value you want. Now, go back into an <code class="highlighter-rouge">irb</code> session and look at what the variable‚Äôs value is. You can see that this variable now exists. Open irb again and look up the environment variable MARKER. It should have the val.</p>

<p>As we mentioned earlier, these variables are local to the terminal session, so they are temporary. We can see this by opening a second terminal window. If you get into <code class="highlighter-rouge">irb</code> in this session and query the <code class="highlighter-rouge">MARKER</code> variable then you will see it is once again nil. When you flip back to the original session it is not</p>

<h4 id="setting-permanent-variables">Setting Permanent Variables</h4>

<p>If you want these environment variables to persist you can declare them in various places. These could include <code class="highlighter-rouge">.bash_profile</code>, <code class="highlighter-rouge">.bashrc</code>, <code class="highlighter-rouge">.profile</code>. Let‚Äôs look into them.</p>

<p>When I open my <code class="highlighter-rouge">.bash_profile</code> I see among other things, <code class="highlighter-rouge">export PATH=/my/specific/path</code>. Anything I declare in these file will be available in any session and will persist until changed either temporarily or permanently.</p>

<p>Go ahead and set a variable in your profile. <code class="highlighter-rouge">export EXAMPLE_VAR="hello1234567"</code>. Now if you open up a new terminal session and investigate the environment variables you will see $EXAMPLE_VAR in every new terminal session, not just the local session.</p>

<h4 id="pragmatically-why">Pragmatically, Why?</h4>

<p>What might we use this for? Let‚Äôs get into the mindset of a Rails Developer. If I want to run a bunch of commands in a different environment, say <code class="highlighter-rouge">staging</code> or <code class="highlighter-rouge">production</code>, we can set a temporary env variable in the current Shell session so we don‚Äôt have to manually declare the name of the environment every time we run a rails command.</p>

<p>You may want to store sensitive data, api keys, and</p>

<h3 id="part-2-rails">Part 2: Rails</h3>

<h4 id="boot-cycle-for-a-rails-app">Boot Cycle for a Rails App</h4>

<p>I think it‚Äôs important to first dig into how a Rails app boots up. <a href="http://guides.rubyonrails.org/initialization.html">Here is the Rails Guide</a> for the initialization process. I suggest you read that whole doc, but since time is limited let‚Äôs investigate a simplified version of how Rails starts to boot up the application when we run <code class="highlighter-rouge">rails s</code> or <code class="highlighter-rouge">rails c</code>.</p>

<p>The thing I want to point out, and focus on is that through the chain of firing up the application Rails eventually calls a method <code class="highlighter-rouge">set_environment</code>. This is done very early on in the boot process and is important. Let‚Äôs look at the <code class="highlighter-rouge">set_environment</code> method:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">set_environment</span>
  <span class="no">ENV</span><span class="p">[</span><span class="s2">"RAILS_ENV"</span><span class="p">]</span> <span class="o">||=</span> <span class="n">options</span><span class="p">[</span><span class="ss">:environment</span><span class="p">]</span>
<span class="k">end</span>
</code></pre></div></div>

<p>this doesn‚Äôt look like much, but when we start to dig into <code class="highlighter-rouge">options</code> the picture of what‚Äôs happening begins to come into focus.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">options</span>
  <span class="vi">@options</span> <span class="o">||=</span> <span class="n">parse_options</span><span class="p">(</span><span class="no">ARGV</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>
<p>then we look at <code class="highlighter-rouge">parse_options(ARGV)</code></p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">parse_options</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
  <span class="n">options</span> <span class="o">=</span> <span class="n">default_options</span>

  <span class="c1"># Don't evaluate CGI ISINDEX parameters.</span>
  <span class="c1"># http://www.meb.uni-bonn.de/docs/cgi/cl.html</span>
  <span class="n">args</span><span class="p">.</span><span class="nf">clear</span> <span class="k">if</span> <span class="no">ENV</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="s2">"REQUEST_METHOD"</span><span class="p">)</span>

  <span class="n">options</span><span class="p">.</span><span class="nf">merge!</span> <span class="n">opt_parser</span><span class="p">.</span><span class="nf">parse!</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
  <span class="n">options</span><span class="p">[</span><span class="ss">:config</span><span class="p">]</span> <span class="o">=</span> <span class="o">::</span><span class="no">File</span><span class="p">.</span><span class="nf">expand_path</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="ss">:config</span><span class="p">])</span>
  <span class="no">ENV</span><span class="p">[</span><span class="s2">"RACK_ENV"</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="ss">:environment</span><span class="p">]</span>
  <span class="n">options</span>
<span class="k">end</span>
</code></pre></div></div>

<p>We can see here that the last two lines set our <code class="highlighter-rouge">ENV["RACK_ENV"]</code> and return <code class="highlighter-rouge">options</code>. Also, <code class="highlighter-rouge">options</code> is initially set to <code class="highlighter-rouge">default_options</code>. <code class="highlighter-rouge">ENV["RACK_ENV"]</code> is important, but let‚Äôs come back to it and look at <code class="highlighter-rouge">default_options</code> so we know what options really are.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">default_options</span>
  <span class="n">environment</span>  <span class="o">=</span> <span class="no">ENV</span><span class="p">[</span><span class="s1">'RACK_ENV'</span><span class="p">]</span> <span class="o">||</span> <span class="s1">'development'</span>
  <span class="n">default_host</span> <span class="o">=</span> <span class="n">environment</span> <span class="o">==</span> <span class="s1">'development'</span> <span class="p">?</span> <span class="s1">'localhost'</span> <span class="p">:</span> <span class="s1">'0.0.0.0'</span>

  <span class="p">{</span>
    <span class="ss">:environment</span> <span class="o">=&gt;</span> <span class="n">environment</span><span class="p">,</span>
    <span class="ss">:pid</span>         <span class="o">=&gt;</span> <span class="kp">nil</span><span class="p">,</span>
    <span class="ss">:Port</span>        <span class="o">=&gt;</span> <span class="mi">9292</span><span class="p">,</span>
    <span class="ss">:Host</span>        <span class="o">=&gt;</span> <span class="n">default_host</span><span class="p">,</span>
    <span class="ss">:AccessLog</span>   <span class="o">=&gt;</span> <span class="p">[],</span>
    <span class="ss">:config</span>      <span class="o">=&gt;</span> <span class="s2">"config.ru"</span>
  <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>So, essentially <code class="highlighter-rouge">default_options</code> is a hash that we see on the last lines of the method. The most important thing to notice here right now is the default <code class="highlighter-rouge">environment</code> local variable that is set up on the first line of the method. If there is no setting of <code class="highlighter-rouge">ENV['RACK_ENV']</code> then the value of <code class="highlighter-rouge">environment</code> becomes ‚Äúdevelopment‚Äù. This is why whenever we just fire up <code class="highlighter-rouge">rails s</code> or <code class="highlighter-rouge">rails c</code> be are by default in the <code class="highlighter-rouge">development</code> environment. If we look back at the <code class="highlighter-rouge">parse_options</code> method above, we notice that we take in the args which is the <code class="highlighter-rouge">ARGV</code> from running the initial boot command.</p>

<p>What does this mean for us? We can pass an optional argument like <code class="highlighter-rouge">RACK_ENV=production</code> when we fire up <code class="highlighter-rouge">rails s</code> (ie: <code class="highlighter-rouge">rails s RACK_ENV=production</code>) and it will set the <code class="highlighter-rouge">options[:environment]</code> to be whatever value we pass to <code class="highlighter-rouge">RACK_ENV</code>.</p>

<p>This is important because in the boot process Rails will execute the initializers and any middlewear corresponding to the defined environment. This includes the file in the <code class="highlighter-rouge">/config/environments</code> directory that corresponds to the defined environment. We already stated that the default environment is <code class="highlighter-rouge">development</code> in which case we would execute the <code class="highlighter-rouge">development.rb</code> file within <code class="highlighter-rouge">/config/environments</code>. But if we fire up our application with <code class="highlighter-rouge">rails s RACK_ENV=production</code> we will execute <code class="highlighter-rouge">/config/environments/production.rb</code>.</p>

<p>With all of this in mind, realizing that this connection to the environment is simply a string that is either set by default or manually when we fire up the app, we can make our own environments.</p>

<p>If we want a staging environment we would need to be setup a file <code class="highlighter-rouge">/config/environments/staging.rb</code>. We would need to set up some configurations, but since staging needs to be relatively the same as <code class="highlighter-rouge">production</code>, a good first step would be to paste the production configurations into the staging environment. We would most likely want some configurations to be different such as <code class="highlighter-rouge">config.consider_all_requests_local = true</code> for example, but I‚Äôll let you dig into that more.</p>

<p>These files within <code class="highlighter-rouge">/config/environments</code> are where we specify the per environment configurations for our Rails applications. If we want a configuration for our <code class="highlighter-rouge">test</code> environment we would put that in the <code class="highlighter-rouge">/config/environments/test.rb</code> file etc.</p>

<p>Another place to take notice of environments is with out GEMFILE. We define <code class="highlighter-rouge">groups</code> for the gems we include and these groups correspond to the specific environment we‚Äôre running the application in.</p>

<p>Let‚Äôs do an experiment here to prove this.</p>

<p>Open a rails application. Open up the <code class="highlighter-rouge">/config/environments</code> directories. Inside of the <code class="highlighter-rouge">development.rb</code> file set an env variable. Something like <code class="highlighter-rouge">ENV["PROOF"] = ====DEVELOPMENT====</code> and then open the <code class="highlighter-rouge">production.rb</code> file and set the same variable to something different, <code class="highlighter-rouge">ENV["PROOF"] = ====PRODUCTION====</code>. Now open the <code class="highlighter-rouge">environment.rb</code>  file and print the environment variable.</p>

<p>Now we can see what we‚Äôve been talking about in action. First, start the server with <code class="highlighter-rouge">rails s</code>. Remmeber the default setting is for this to be the development environment. You should see the varaible value you set in the <code class="highlighter-rouge">developmnet.rb</code> file print in the terminal. Now, if you start the server in the production environment you should see the other value for that variable printed in the server.</p>

<h4 id="databaseyml">Database.yml</h4>

<p>Other than the environment configuration file, it‚Äôs important to look into the <code class="highlighter-rouge">database.yml</code> file when we talk about environments.</p>

<p>If you open up a <code class="highlighter-rouge">database.yml</code> you will see something similar to this:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">default</span><span class="pi">:</span> <span class="nl">&amp;default</span>
  <span class="na">adapter</span><span class="pi">:</span> <span class="s">postgresql</span>
  <span class="na">encoding</span><span class="pi">:</span> <span class="s">unicode</span>
  <span class="c1"># For details on connection pooling, see rails configuration guide</span>
  <span class="c1"># http://guides.rubyonrails.org/configuring.html#database-pooling</span>
  <span class="na">pool</span><span class="pi">:</span> <span class="s">&lt;%= ENV.fetch("RAILS_MAX_THREADS") { 5 } %&gt;</span>

<span class="na">development</span><span class="pi">:</span>
  <span class="s">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*default</span>
  <span class="na">database</span><span class="pi">:</span> <span class="s">exploration_development</span>

<span class="na">test</span><span class="pi">:</span>
  <span class="s">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*default</span>
  <span class="na">database</span><span class="pi">:</span> <span class="s">exploration_test</span>

<span class="na">production</span><span class="pi">:</span>
  <span class="s">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*default</span>
  <span class="na">database</span><span class="pi">:</span> <span class="s">exploration_production</span>
  <span class="na">username</span><span class="pi">:</span> <span class="s">exploration</span>
  <span class="na">password</span><span class="pi">:</span> <span class="s">&lt;%= ENV['EXPLORATION_DATABASE_PASSWORD'] %&gt;</span>

</code></pre></div></div>

<p>You should take note that the far left of this file are the keys <code class="highlighter-rouge">development</code>, <code class="highlighter-rouge">test</code>, <code class="highlighter-rouge">production</code> and underneath these are some other key values.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">development</span><span class="pi">:</span>
  <span class="s">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*default</span>
  <span class="na">database</span><span class="pi">:</span> <span class="s">exploration_development</span>
</code></pre></div></div>
<p>What is happening here is that this file is deciding which set of configurations to use based on the environment we‚Äôre running the application in. In the above example, the <code class="highlighter-rouge">development</code> environment is set up to use a database called <code class="highlighter-rouge">exploration_development</code> and the line <code class="highlighter-rouge">&lt;&lt;: #default</code> is including the default settings in the <code class="highlighter-rouge">development</code> database configuration. The postgresql databases name that we see in these configurations as <code class="highlighter-rouge">database:</code> has a naming convention in Rails as the name of the app followed by the name of the environment. The name of this app is <code class="highlighter-rouge">exploration</code>.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">production</span><span class="pi">:</span>
  <span class="s">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*default</span>
  <span class="na">database</span><span class="pi">:</span> <span class="s">exploration_production</span>
  <span class="na">username</span><span class="pi">:</span> <span class="s">exploration</span>
  <span class="na">password</span><span class="pi">:</span> <span class="s">&lt;%= ENV['EXPLORATION_DATABASE_PASSWORD'] %&gt;</span>
</code></pre></div></div>

<p>The <code class="highlighter-rouge">production</code> configurations have a little more going on. We see in addition to the default configs we also have the database name configured to be <code class="highlighter-rouge">exploration_production</code>, and there is also a <code class="highlighter-rouge">username</code> and <code class="highlighter-rouge">password</code> configuration.</p>

<p>There are other <a href="http://edgeguides.rubyonrails.org/configuring.html#configuring-a-database">database configurations</a> you can set to customize your database in Rails.</p>

<h3 id="part-3-heroku">Part 3: Heroku</h3>

<p>Heroku provides us a server to host our application. A server is a machine much like our laptops that runs an operating system. The server has environment variables just like our machines.</p>

<p>You can access a bash session on a heroku server, just like our terminal sessions. To open this simply run <code class="highlighter-rouge">heroku run bash</code> on any app you have hosted on heroku.</p>

<p>Once the bash session is open you can then look at the environment variables just like you would on your machine. <code class="highlighter-rouge">env</code>, <code class="highlighter-rouge">printenv</code>, <code class="highlighter-rouge">echo $VARIABLE</code>,.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ heroku run bash
~$ env
# you will see all your env variables here
</code></pre></div></div>

<p>Heroku provides us an easy way to access, set, and unset all our environment variables. The command to do this is <code class="highlighter-rouge">config</code>.</p>

<p>Running <code class="highlighter-rouge">heroku config</code> will give you a list of all the environment variables that you have set. Heroku calls these Config Vars. You can add one with the command <code class="highlighter-rouge">heroku config:set key=valueofkey123</code>. Using the <code class="highlighter-rouge">config:set</code> command will also overwrite a key that was already there by the same name. And you can remove one with the unset <code class="highlighter-rouge">heroku config:unset key</code>.</p>

<p>A hypothetical example of something we could use environment variables for in production, besides for API keys, could be this:</p>

<p>Say we have a homepage with many many dynamic assets (images, products, descriptions, maybe even videos). This works great for clients that have enough bandwidth to handle loading all these assets. However some users may not be able to handle loading all this making for an unpleasant UX. One way we could potentially solve this UX problem would be to store information about the users bandwidth in an environment variable and look at that variable to decide whether or not to load the asset heavy homepage or a different version of the homepage that is static and does not have all the assets to load.</p>

<p>Our view could, hypothetically look something like this:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if(ENV["BANDWIDTH_THRESHOLD?"])
  <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="n">partial</span> <span class="ss">:dynamic_asset_heavy_home</span> <span class="cp">%&gt;</span>
else
  <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="n">partial</span> <span class="ss">:static_low_asset_home</span> <span class="cp">%&gt;</span>
end
</code></pre></div></div>
:ET