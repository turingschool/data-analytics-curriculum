I"Q<p>Warm-Up Prompts:</p>

<ul>
  <li>What is Caching?</li>
  <li>What is Memoization?</li>
  <li>What‚Äôs the difference?</li>
</ul>

<p>Write out some answers to these questions before expanding the notes below!</p>

<hr />

<details>
  <summary>Click to expand!</summary>

<h2>Cache</h2>
<ul>
  <li>auxiliary memory from which high-speed retrieval is possible</li>
  <li>storage of data so future requests for that data can be served faster</li>
  <li>stored data might be the result of an earlier computation or a copy of data stored elsewhere</li>
</ul>

<h2>Memoization</h2>
<ul>
  <li>an optimization technique used primarily to speed up computer programs by storing the results of expensive function calls and returning the cached result when the same inputs occur again</li>
</ul>

<h2>Isn't that the same thing?</h2>

<p>No. Caching is STORING the data. Memoization is caching the RETURN VALUE of a function.</p>

<code>
  cache = {}                   # this is our cache
  cache['jenny'] = '867-5309'  # this is "caching" the data
  puts cache['jenny']          # this is using "memoization" to retrieve the data
</code>

<p>Back in the "old days" we had to look up people's phone numbers in a giant phone book. Caching would be like adding my favorite people in a smaller address book. Occasionally I might need to update their phone number from the bigger phone book, but now I have a smaller, easier-to-access book that I can maybe carry in my pocket.</p>

<p>Memoization would be like the address books that had little letters/tabs on the side to skip to all of my friends who start with "S" to get Sal's phone number in a hurry. The book is the cache, but the lookup of that data from the cache is memoization.</p>
</details>

<hr />

<h2 id="breakout-groups">Breakout Groups</h2>

<p>Discuss in your group:</p>

<ol>
  <li>How caching and memoization can be benefitial in the applications we‚Äôve been making in Mod 3 so far</li>
  <li>How the ideas here could help in your group project</li>
</ol>

<h2 id="group-discussion">Group Discussion</h2>

<p>Let‚Äôs call on some random groups to discuss your thoughts.</p>

<hr />

<h2 id="benefits-in-our-applications">Benefits in Our Applications</h2>

<p>The primary benefit we‚Äôll see in Rails is fetching API data. If the user is searching for the same data a second time, do we really need to make another API call to get the same data back? How likely is it that the data has changed since we last retrieved the results?</p>

<h2 id="quick-review-of-other-memoization-youve-done">Quick Review of other Memoization you‚Äôve done</h2>

<p>In discussion of authentication, we typically create a <code class="highlighter-rouge">current_user</code> method in our <code class="highlighter-rouge">ApplicationController</code> as a helper method, which allows us to fetch, and remember, who a current user is.</p>

<p>This has benefits in that we can call <code class="highlighter-rouge">current_user</code> over and over again, and we only go to the database one time.</p>

<p>The downside to this memoized data is that it disappears as soon as we build our HTTP response and close the connection for that user. Every connection coming to our Rails server is treated as a brand new request/respoinse cycle, and the first time we try to use <code class="highlighter-rouge">current_user</code> we have to look it up all over again, but the we can reuse it as many times as we need to until we send back that HTTP response.</p>

<h2 id="how-is-rails-caching-going-to-be-different-than-memoization">How is Rails caching going to be different than Memoization</h2>

<p>In our Rails cache, we can remember things beyond a single HTTP request/response transaction. If a guest visits our site and we process some data, or fetch something from an API, and we send back that response, we COULD remember the data for the next user who comes to our site and is looking for the EXACT same data.</p>

<p>If we think about hitting a food API, for example, and someone searches for the recipe for ‚Äúscalloped potatoes‚Äù, we could ‚Äúcache‚Äù that recipe for a while, and use ‚Äúmemoization‚Äù to retrieve the recipe the next time someone searches for the same text.</p>

<p>At some point, though, we should probably refresh that recipe. Also, whenever Rails restarts, it forgets everything it cached.</p>

<h2 id="speed-improvements">Speed Improvements</h2>

<p>Caching and Memoization don‚Äôt actually make our application faster the first time someone searches for data, as we still have to process some data, or make a calculation, or go fetch something from an API. But the speed optimization happens for the NEXT user.</p>

<p>One parallel to draw here is using VCR with our API testing. The first test to use VCR has to go make a real API call, but then that inforamation is remembered so the next time we try to do the exact same operation, VCR uses the stored (cached) result and uses memoization to replace the ‚Äúreturn value‚Äù of calling Faraday.</p>

<hr />

<h2 id="workshop">Workshop!</h2>

<p>Rails can implement caching in different ways, but the great thing is that it‚Äôs BUILT INTO Rails. There‚Äôs actually relatively little we need to do to enable it and to use it, and the performance boosts make for a great user experience.</p>

<p>Using the code-along you‚Äôve been doing with your instructors in week 1 and 2 (ie, Propublica, or Dog API, etc), work in small groups in breakout rooms to implement some simple caching.</p>

<p>Reference the <a href="https://guides.rubyonrails.org/caching_with_rails.html">Rails documentation</a> and avoid using third-party gems.</p>

<p>We‚Äôre going to call on some groups at the end of the class to see what you‚Äôve come up with!</p>

<hr />

<h2 id="gotchas-and-things-to-be-aware-of">Gotchas, and Things to Be Aware of</h2>

<p>There are ways you can use a <code class="highlighter-rouge">cache</code> keyword in our Views but we need to know how to ‚Äúname‚Äù things in our cache. If you use a term which is too generic, you risk overwriting data. If you use a term which is highly specific you can remember finer details, but risk using a lot more memory. Look up the Rails documentation for how to cache things with a ‚Äúkey‚Äù name of some type.</p>

<h4 id="how-will-you-invalidate-cached-data-so-you-retrieve-a-new-copy-later">How will you ‚Äúinvalidate‚Äù cached data so you retrieve a new copy later?</h4>

<p>Just like VCR and refreshing those cassettes, we don‚Äôt want to try to remember our fetched data forever otherwise we might as well just put it in a database. Look up Rails documentation for how to cache things for a period of time. What seems resonable for a period of time to remember some details? Should some details be remembered longer than others?</p>

<h4 id="how-can-we-cache-non-view-code-like-our-api-calls">How can we cache non-View code, like our API calls?</h4>

<p>Check the documentation page for how you can implement some low-level caching.</p>
:ET