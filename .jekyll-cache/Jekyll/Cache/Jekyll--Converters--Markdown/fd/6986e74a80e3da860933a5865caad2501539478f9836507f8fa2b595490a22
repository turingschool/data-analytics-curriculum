I"¢<h2 id="learning-goals">Learning Goals</h2>

<ul>
  <li>Understand the purpose of a test double</li>
  <li>Begin to identify situations where a test mock or stub will be useful</li>
  <li>Practice mocking with 3 popular libraries ‚Äì Minitest::Mock, Mocha, and
rspec-mocks</li>
  <li>Learn some key test-object terminology both in the general case and in
the ways it applies to our specific test libraries.</li>
  <li>Discuss potential downsides of over-zealous mocking and stubbing.</li>
</ul>

<h2 id="structure">Structure</h2>

<ul>
  <li>25 - Initial discussion of Mock/Stub use-cases and terminology.</li>
  <li>5 - POMODORO</li>
  <li>25 - Work through ‚Äúmockickal creatures‚Äù exercise using 3 different
mocking libraries</li>
  <li>5 - POMODORO</li>
  <li>25 - Individual work ‚Äì Independent Project Testing</li>
  <li>5 - wrap-up/review</li>
</ul>

<h2 id="primary-mocking-use-cases">Primary Mocking Use-Cases</h2>

<ul>
  <li>Behavior outside your control (e.g. a gem or class that another
team-member is working on)</li>
  <li>Behavior that is difficult to setup and reproduce within a test
environment (e.g. a Service Object which fronts an extensive service
infrastructure that is difficult to set up)</li>
  <li>Slow things (HTTP requests, computationally expensive Data Crunching)</li>
  <li>Unpredictable things (e.g. rand(), live-updated data)</li>
  <li>Time-based things (e.g. Time.now, day-of-week)</li>
</ul>

<h2 id="key-terms">Key Terms</h2>

<ul>
  <li>Object-Under-Test - The specific object or class on which a given
unit-test focuses (your unit tests do focus on a single object at
a time, don‚Äôt they?)</li>
  <li>Collaborator - A secondary object whose behavior we are not focusing
on in a unit test, but which is needed for our Object-Under-Test to do
its work. ActiveRecord associations are a common example.</li>
  <li>State verification - Testing based on begin/end state of our test
objects (order count starts at 5, ends at 6, etc.)</li>
  <li>Behavior verification - Testing based on incoming/outgoing messages
and parameters (Order receives <code class="highlighter-rouge">#place_order</code> with item id 5 and
quantity 3) ‚Äì better isolation; let your objects control their own
state.</li>
  <li>Double - Generic term for this family of stand-in test objects. (Comes
from idea of a stunt double)</li>
  <li>Mock - A stand-in object which implements enough functionality to make
it a useful replacement for a collaborator. Often includes
pre-programmed responses and validation of received messages.</li>
  <li>Stub - Act of scripting an object with pre-programmed responses to
certain expected inputs. Often done to override the ‚Äúreal‚Äù
implementation with something we control.</li>
  <li>Expectation - In this context an expectation functions similarly to a
stub, but it includes some mechanism for verifying that the expected
behavior was actually invoked.</li>
</ul>

<p><strong>Caveat: this terminology is much-debated in the TDD community.
So if you come across alternate uses of the terms, don‚Äôt be surprised.</strong></p>

<h2 id="common-approaches">Common Approaches</h2>

<ul>
  <li>‚ÄúClassical‚Äù TDD ‚Äì use the real objects whenever possible, and insert
a mock or stub when the real thing becomes a pain. Tends to be
slightly lazier and more pragmatic. This is how most people tend to
operate in a rails context.</li>
  <li>‚ÄúMockist‚Äù or ‚ÄúPure‚Äù TDD ‚Äì pursue a more zealous isolation of our
object-under-test, turning to test doubles wherever possible to remove
external dependencies. Gives great isolation, speed and design feedback
about your Object APIs. Requires more work. ‚ÄúDream Driven Development‚Äù. Very powerful when TDD-ing a multi-layered system from scratch.</li>
</ul>

<h2 id="popular-tools">Popular tools</h2>

<ul>
  <li>Minitest::Mock ‚Äì most barebones, included in basic minitest. API is
more laborious to use.</li>
  <li>Mocha ‚Äì popular mocking/stubbing add-on to test-unit or minitest.
Gives very nice API. Somewhat invasive use of metaprogramming.</li>
  <li>Rspec mocks ‚Äì Rspec has its own mocking and stubbing library built
in.</li>
</ul>

<h2 id="exercise--mockical-creatures">Exercise ‚Äì Mockical Creatures</h2>

<p>Work through this short exercise as an introduction to mocking and
stubbing: <a href="https://github.com/turingschool/mockical-creatures">Mockical-Creatures</a></p>

<h2 id="exercise--independent-project-testing">Exercise ‚Äì Independent Project Testing</h2>

<p>You recently finished individual rails projects. Let‚Äôs revisit those
with an eye toward mocking and stubbing. Pull up your individual project
and read through the test suite with an eye for:</p>

<ul>
  <li>a) A test which required elaborate or laborious setup to implement a
simple test requirement (3rd party APIs or complicated ActiveRecord
relationships can often cause this)</li>
  <li>b) something you would have liked to test but did not because of how
difficult the setup would have been</li>
</ul>

<p>Apply Mocking/Stubbing techniques to your tests. If you project uses
Rspec you‚Äôll likely want to just use rspec-mocks. If you were using
Minitest, take your pick of Mocha or built-in Minitest::Mocks. See if
you can cleanup an otherwise tedious test implementation by inserting a
mock or stub.</p>

<h2 id="further-reading">Further Reading</h2>

<ul>
  <li><a href="http://martinfowler.com/articles/mocksArentStubs.html">Mocks aren‚Äôt Stubs</a></li>
  <li><a href="https://github.com/travisjeffery/timecop">TimeCop</a></li>
  <li><a href="http://www.ibm.com/developerworks/library/wa-mockrails">Mocking and Stubbing in Ruby and Rails</a></li>
  <li><a href="https://github.com/freerange/mocha">Mocha Readme</a></li>
  <li><a href="https://github.com/rspec/rspec-mocks">Rspec Mocks</a></li>
</ul>
:ET