I"¬<h3 id="learning-goals">Learning Goals</h3>

<ul>
  <li>Practice core ActiveRecord methods and concepts</li>
  <li>Revisit SQL concepts</li>
</ul>

<h3 id="structure">Structure</h3>

<ul>
  <li>Code Challenges (90 minutes)</li>
  <li>Solutions (30 minutes)</li>
</ul>

<h3 id="instructions">Instructions</h3>

<p><code class="highlighter-rouge">$ git clone https://github.com/turingschool-examples/storedom</code>
<code class="highlighter-rouge">$ git checkout active_record_american_gladiator</code></p>

<p>Do the normal Rails-y setup stuff. Run your tests using the <code class="highlighter-rouge">rspec</code> command. You should see one failing test with the remainder skipped. You will only need to edit code in this spec file: <code class="highlighter-rouge">./spec/active_record_american_gladiator_spec.rb</code>. Do not change code in the models to get the tests to pass.</p>

<p>Update <em>only</em> the code between the <code class="highlighter-rouge">#Changeable Start</code> and <code class="highlighter-rouge">#Changeable End</code> tags. Leave the rest of the code the same.</p>

<h4 id="failing-tests">Failing Tests</h4>

<p>For the tests that are failing, get them to pass.</p>

<h4 id="passing-tests">Passing Tests</h4>

<p>For the tests that are passing, you need to refactor them to using more efficient ActiveRecord techniques.</p>

<p>Some of the challenges are quiteâ€¦ uhhâ€¦ challenging. There are links to resources that are commented out to help find solutions.</p>

<p>Itâ€™s highly recommended that you become familiar with the <a href="http://guides.rubyonrails.org/active_record_querying.html">ActiveRecord Querying page</a> on the Rails Guides, particularly for upcoming projects.</p>

<h3 id="hints">Hints</h3>

<p>Solutions use the following techniques:</p>

<ul>
  <li><code class="highlighter-rouge">.unscoped</code></li>
  <li><code class="highlighter-rouge">.joins</code></li>
  <li><code class="highlighter-rouge">.includes</code></li>
  <li>Queries using conditionals across multiple tables</li>
  <li>Queries using <code class="highlighter-rouge">.select</code>
    <ul>
      <li>Show that when you use <code class="highlighter-rouge">AS</code> you have access to that as a method on the object. eg <code class="highlighter-rouge">Item.select("items.*, count(order_items.item_id) AS items_count").joins(:order_items).group("items.id").map(&amp;:items_count)</code> would return an array of <code class="highlighter-rouge">items_count</code> for each item. See the Atlasphere example.</li>
    </ul>
  </li>
  <li>Finding solutions to problems not covered in documentation
    <ul>
      <li>Build your queries slowly, adding pieces one at a time.</li>
      <li>Read the ActiveRecord Querying page on the Rails Guides to learn the language to use in your Google searches.</li>
      <li>Break down the problem for Atlasphere:
        <ul>
          <li>Most popular items are the items that appear most frequently on orders. In SQL terms this is the <code class="highlighter-rouge">COUNT</code> and in ActiveRecord <code class="highlighter-rouge">count</code>.</li>
          <li>We need to keep a running tally for each item. In SQL we can use <code class="highlighter-rouge">GROUP BY</code> and in ActiveRecord <code class="highlighter-rouge">group</code>.</li>
          <li>We know we keep track of ordered items in the <code class="highlighter-rouge">order_items</code> table.</li>
          <li>In English, we want to <code class="highlighter-rouge">Order items by the number of times an item appears in the order_items table using ActiveRecord.</code>. This is too specific for a Google search.</li>
          <li>Letâ€™s make it Google-able. We can substitute <code class="highlighter-rouge">number of times</code> with <code class="highlighter-rouge">count</code> since thatâ€™s an ActiveRecord term. And letâ€™s remove the specific nouns from our sentence and use broader terms that describe our relationships. <code class="highlighter-rouge">Order by count on association rails</code> should yield promising results.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="resources">Resources</h3>

<ul>
  <li><a href="https://gist.github.com/jmejia/1a07f1300d7a1d13f97d">Possible Solutions</a></li>
</ul>
:ET